// layerJS 0.6.1
// https://github.com/layerJS/layerJS
// contact us at developers@layerjs.org
// (c) 2017 - 2018
// this is open-source software. some restrictions apply.
// see https://github.com/layerJS/layerJS/blob/master/LICENSE
// branch: master
// commit: 0275f8335222e77d82a632d6079792a9411580c4


var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,l,h){e!=Array.prototype&&e!=Object.prototype&&(e[l]=h.value)};$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var e=0;return function(l){return $jscomp.SYMBOL_PREFIX+(l||"")+e++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(e){var l=0;return $jscomp.iteratorPrototype(function(){return l<e.length?{done:!1,value:e[l++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};$jscomp.iteratorFromArray=function(e,l){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var h=0,g={next:function(){if(h<e.length){var f=h++;return{value:l(f,e[f]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};
$jscomp.polyfill=function(e,l,h,g){if(l){h=$jscomp.global;e=e.split(".");for(g=0;g<e.length-1;g++){var f=e[g];f in h||(h[f]={});h=h[f]}e=e[e.length-1];g=h[e];l=l(g);l!=g&&null!=l&&$jscomp.defineProperty(h,e,{configurable:!0,writable:!0,value:l})}};$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6","es3");
$jscomp.checkStringArgs=function(e,l,h){if(null==e)throw new TypeError("The 'this' value for String.prototype."+h+" must not be null or undefined");if(l instanceof RegExp)throw new TypeError("First argument to String.prototype."+h+" must not be a regular expression");return e+""};
$jscomp.polyfill("String.prototype.startsWith",function(e){return e?e:function(e,h){var g=$jscomp.checkStringArgs(this,e,"startsWith");e+="";var f=g.length,d=e.length;h=Math.max(0,Math.min(h|0,g.length));for(var b=0;b<d&&h<f;)if(g[h++]!=e[b++])return!1;return b>=d}},"es6","es3");$jscomp.polyfill("Number.parseFloat",function(e){return e||parseFloat},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(e){return e?e:function(e,h){var g=$jscomp.checkStringArgs(this,e,"endsWith");e+="";void 0===h&&(h=g.length);h=Math.max(0,Math.min(h|0,g.length));for(var f=e.length;0<f&&0<h;)if(g[--h]!=e[--f])return!1;return 0>=f}},"es6","es3");
(function(){function e(l,h,g){function f(a,b){if(!h[a]){if(!l[a]){var k="function"==typeof require&&require;if(!b&&k)return k(a,!0);if(d)return d(a,!0);b=Error("Cannot find module '"+a+"'");throw b.code="MODULE_NOT_FOUND",b;}b=h[a]={exports:{}};l[a][0].call(b.exports,function(b){return f(l[a][1][b]||b)},b,b.exports,e,l,h,g)}return h[a].exports}for(var d="function"==typeof require&&require,b=0;b<g.length;b++)f(g[b]);return f}return e})()({1:[function(e,l,h){var g=e("./domhelpers.js"),f=e("./pluginmanager.js"),
d=e("./parsemanager.js"),b=e("./observer/domobserver.js");e=b.extend({constructor:function(a){a=a||{};b.call(this);this._cache={};this.childType=a.childType;this._setDocument(a);this.parent=a.parent;this.innerEl=this.innerEl||a.el;if(this.innerEl._ljView)throw"trying to initialialize view on element that already has a view";this.innerEl._ljView=this;this.outerEl=this.outerEl||a.el||this.innerEl;this.outerEl._ljView=this;this._parseChildren();this.registerEventHandlers();this.startObserving()},startObserving:function(){},
registerEventHandlers:function(){this.on("childrenChanged",function(a){(a.addedNodes&&0<a.addedNodes.length||a.removedNodes&&0<a.removedNodes.length)&&this._parseChildren({addedNodes:a.addedNodes,removedNodes:a.removedNodes})})},_parseChildren:function(a){a=a||{};var b=this;this._cache.children=[];this._cache.childNames={};this._cache.childIDs={};a.removedNodes&&0<a.removedNodes.length&&a.removedNodes.forEach(function(c){c._ljView&&b.trigger("childRemoved",c._ljView)});var p={};if(this.childType)for(var m=
0;m<this.innerEl.children.length;m++){var c=this.innerEl.children[m];c._ljView||g.getAttributeLJ(c,"type")!==this.childType||(f.createView(this.childType,{el:c,parent:this,document:this.document}),this._renderChildPosition(c._ljView),this.trigger("childAdded",c._ljView),p[c._ljView.id()]=1);c._ljView&&c._ljView.type()===this.childType&&(c=c._ljView,this._cache.children.push(c),this._cache.childNames[c.name()]=c,this._cache.childIDs[c.id()]=c)}m=!1;if(a.addedNodes&&0<a.addedNodes.length){c=a.addedNodes.length;
for(var n=0;n<c;n++)a.addedNodes[n].parentElement===this.innerEl&&(a.addedNodes[n]._ljView?a.addedNodes[n]._ljView.parent!==this&&(a.addedNodes[n]._ljView.parent=this):m||(d.parseElement(a.addedNodes[n].parentNode,{parent:this}),m=!0),a.addedNodes[n]._ljView&&!p[a.addedNodes[n]._ljView.id()]&&this.trigger("childAdded",a.addedNodes[n]._ljView))}},getChildViewByName:function(a){this._cache.childNames||this._parseChildren();return this._cache.childNames[a]},getChildViews:function(){this._cache.children||
this._parseChildren();return this._cache.children},_setDocument:function(a){this.document=document;a&&(a.document?this.document=a.document:a.el&&(this.document=a.el.ownerDocument))},_renderChildPosition:function(a){},applyStyles:function(){for(var a=arguments.length,b=0;b<a;b++)for(var f=Object.keys(arguments[b]),d=0;d<f.length;d++)g.cssPrefix[f[d]]&&(this.outerEl.style[g.cssPrefix[f[d]]]=arguments[b][f[d]]),this.outerEl.style[f[d]]=arguments[b][f[d]]},setAttributeLJ:function(a,b){g.hasCssAttributeLJ(this.outerEl,
a)?g.setCssAttributeLJ(this.outerEl,a,b):g.setAttributeLJ(this.outerEl,a,b)},getAttributeLJ:function(a){return g.getCssAttributeLJ(this.outerEl,a)||g.getAttributeLJ(this.outerEl,a)},getAttribute:function(a){return this.outerEl.getAttribute(a)},id:function(){this._id||(this._id=this.getAttributeLJ("id")||this.outerEl.id||g.uniqueID(this.type(),this.document));return this._id},name:function(){var a=this.getAttributeLJ("name")||this.id();if(a.match(/\./)){if(this._name)return this._name;console.warn('unsuitable layerJS name "'+
a+'" replaced by "'+(this._name=a=g.uniqueID(this.type(),this.document))+'"')}this._name&&(this._name=a);return a},type:function(){return this.getAttributeLJ("type")},nodeType:function(){return this.outerEl&&this.outerEl.nodeType},width:function(){var a=this.getAttributeLJ("width")||this.getAttribute("width");null!==a?this.setWidth(a):a=this.outerEl.offsetWidth||this.outerEl.style.width||0;return g.parseDimension(a,this.outerEl)},height:function(){var a=this.getAttributeLJ("height")||this.getAttribute("height");
null!==a?this.setHeight(a):a=this.outerEl.offsetHeight||this.outerEl.style.height||0;return g.parseDimension(a,this.outerEl)},setWidth:function(a){a=g.parseDimension(a,this.outerEl);var b=this.getMargin();this.outerEl.style.width=a-(b.left+b.right)+"px"},setHeight:function(a){a=g.parseDimension(a,this.outerEl);var b=this.getMargin();this.outerEl.style.height=a-(b.top+b.bottom)+"px"},x:function(){var a=this.getAttributeLJ("x");a=a||this.outerEl.offsetLeft||this.outerEl.style.left||0;return g.parseDimension(a,
this.outerEl)},y:function(){var a=this.getAttributeLJ("y");a=a||this.outerEl.offsetTop||this.outerEl.style.top||0;return g.parseDimension(a)},scaleX:function(){var a=this.getAttributeLJ("scale")||this.getAttributeLJ("scale-x");return a?parseFloat(a):1},scaleY:function(){var a=this.getAttributeLJ("scale")||this.getAttributeLJ("scale-y");return a?parseFloat(a):1},fitTo:function(a){var b=this.getAttributeLJ("fit-to");!1===a||b||(b="width");return b},elasticLeft:function(){return this.getAttributeLJ("elastic-left")},
elasticRight:function(){return this.getAttributeLJ("elastic-right")},elasticTop:function(){return this.getAttributeLJ("elastic-top")},elasticBottom:function(){return this.getAttributeLJ("elastic-bottom")},startPosition:function(){return this.getAttributeLJ("start-position")||"top-left"},noScrolling:function(){var a=this.getAttributeLJ("no-scrolling");return a?"true"===a:!1},rotation:function(){return this.getAttributeLJ("rotation")},neighbors:function(){return{l:this.getAttributeLJ("neighbors.l"),
r:this.getAttributeLJ("neighbors.r"),t:this.getAttributeLJ("neighbors.t"),b:this.getAttributeLJ("neighbors.b")}},layoutType:function(){return this.getAttributeLJ("layout-type")||this.getAttributeLJ("layout")||"slide"},defaultFrame:function(){return this.getAttributeLJ("default-frame")},defaultTransition:function(){return this.getAttributeLJ("transition")},nativeScroll:function(){var a=this.getAttributeLJ("native-scroll");return a?"true"===a:!0},setNativeScroll:function(a){this.setAttributeLJ("native-scroll",
a)},getMargin:function(){var a=this.getComputedStyle();return{top:g.parseDimension(a.getPropertyValue("margin-top")||"0"),bottom:g.parseDimension(a.getPropertyValue("margin-bottom")||"0"),right:g.parseDimension(a.getPropertyValue("margin-right")||"0"),left:g.parseDimension(a.getPropertyValue("margin-left")||"0")}},noUrl:function(){return"true"===this.getAttributeLJ("no-url")?!0:!1},timer:function(){return this.getAttributeLJ("timer")},autoHeight:function(){return this.getAttributeLJ("auto-height")},
autoWidth:function(){return this.getAttributeLJ("auto-width")},draggable:function(){return"true"===this.getAttributeLJ("draggable")?!0:!1},destroy:function(){this.unobserve();this.outerEl.parentNode.removeChild(this.outerEl)},setOriginalWidth:function(){this.originalWidth={width:""===this.outerEl.style.width?"":this.outerEl.style.width,computedStyleWidth:g.parseDimension(this.getComputedStyle().getPropertyValue("width"),this.outerEl)}},getOriginalWidth:function(){return this.originalWidth},setOriginalHeight:function(){this.originalHeight=
{height:""===this.outerEl.style.height?"":this.outerEl.style.height,computedStyleHeight:g.parseDimension(this.getComputedStyle().getPropertyValue("height"),this.outerEl)}},getOriginalHeight:function(){return this.originalHeight},getComputedStyle:function(){return window.getComputedStyle(this.outerEl,null)},widthSet:function(a){void 0!==a&&(this.widthSetByLJ=a);return this.widthSetByLJ},heightSet:function(a){void 0!==a&&(this.heightSetByLJ=a);return this.heightSetByLJ}});l.exports=e},{"./domhelpers.js":3,
"./observer/domobserver.js":14,"./parsemanager.js":21,"./pluginmanager.js":22}],2:[function(e,l,h){l.exports={version:"default",defaultDuration:"1s",transitionParameters:{duration:"t",type:"p",delay:"d"},identifyPriority:{low:1,normal:2,high:3},directions2neighbors:{up:"b",down:"t",left:"r",right:"l"},neighbors2transition:{b:"auto:up",t:"auto:down",r:"auto:left",l:"auto:right"},specialFrames:{none:"!none",left:"!left",right:"!right",top:"!top",bottom:"!bottom",next:"!next",previous:"!prev",default:"!default",
current:"!current",toggle:"!toggle"}}},{}],3:[function(e,l,h){var g=e("./defaults.js"),f=e("./tmat.js"),d=null,b={wrapChildren:function(a,b){b=b||{};for(b=a.ownerDocument.createElement(b.tag||"div");a.childNodes.length;)b.appendChild(a.childNodes[0]);a.appendChild(b);return b},unwrapChildren:function(a){for(var b=a.removeChild(a.children[0]);b.childNodes.length;)a.appendChild(b.childNodes[0])},addClass:function(a,b){a.className+=(a.className?" ":"")+b},removeClass:function(a,b){a.className=a.className.replace(new RegExp("(?:\\s+|^)"+
b+"(?:\\s+|$)"),"")},detectBrowser:function(){var a;"undefined"===typeof navigator?this.browser="node":(a=navigator.userAgent.match(/Edge\/([0-9]*)/))?(this.vendorPrefix="-ms-",this.browserVersion=a[1],this.browser="edge"):(a=navigator.userAgent.match(/MSIE ([0-9]*)/))?(this.vendorPrefix="-ms-",this.browserVersion=a[1],this.browser="ie"):(a=navigator.userAgent.match(/Trident.*rv:([0-9]*)/))?(this.vendorPrefix="-ms-",this.browserVersion=a[1],this.browser="ie"):(a=navigator.userAgent.match(/Chrome\/([0-9]*)/))?
(this.vendorPrefix="-webkit-",this.browserVersion=a[1],this.browser="chrome"):(a=navigator.userAgent.match(/Firefox\/([0-9]*)/))?(this.vendorPrefix="",this.browserVersion=a[1],this.browser="firefox"):navigator.userAgent.match(/iPad|iPhone|iPod/)?(this.vendorPrefix="-webkit-",this.browserVersion=0,this.browser="ios"):(a=navigator.userAgent.match(/Safari\/([0-9]*)/))?(this.vendorPrefix="-webkit-",this.browserVersion=a[1],this.browser="safari"):navigator.userAgent.match(/AppleWebKit/)&&(this.vendorPrefix=
"-webkit-",this.browserVersion=0,this.browser="webkit")},calculatePrefixes:function(a){this.cssPrefix=this.cssPrefix||{};for(var b=0;b<a.length;b++)this.cssPrefix[a[b]]=this.vendorPrefix&&this.vendorPrefix+a[b]||a[b]},postAnimationFrame:function(a){(window.requestAnimationFrame||function(a){setTimeout(a,1E3/60)})(function(){setTimeout(a,0)})},selectView:function(a){a=a instanceof HTMLElement?[a]:document.querySelectorAll(a);for(var b=0;b<a.length;b++)if(a[b]._ljView)return a[b]._ljView},addDelegtedListener:function(a,
b,f,d){window.Element.prototype.matches||(window.Element.prototype.matches=window.Element.prototype.matchesSelector||window.Element.prototype.mozMatchesSelector||window.Element.prototype.msMatchesSelector||window.Element.prototype.oMatchesSelector||window.Element.prototype.webkitMatchesSelector||function(c){c=(this.document||this.ownerDocument).querySelectorAll(c);for(var a=c.length;0<=--a&&c.item(a)!==this;);return-1<a});a.addEventListener(b,function(c){for(var b=c.target;b!==a&&!b.matches(f);)b=
b.parentNode;b!==a&&d.call(b,c)})},comparePosition:function(a,b){if(a===b)return 0;if(!a.compareDocumentPosition)return a.sourceIndex-b.sourceIndex;a=a.compareDocumentPosition(b);if(a&window.Node.DOCUMENT_POSITION_DISCONNECTED)throw"compare position: the two elements belong to different documents";return a&window.Node.DOCUMENT_POSITION_PRECEDING||a&window.Node.DOCUMENT_POSITION_CONTAINS?1:-1},getAttributeLJ:function(a,b){return a.getAttribute("data-lj-"+b)||a.getAttribute("lj-"+b)},getCssAttributeLJ:function(a,
b){return(a=window.getComputedStyle(a,null).getPropertyValue("--lj-"+b))?a.trim():a},hasAttributeLJ:function(a,b){return a.hasAttribute("data-lj-"+b)||a.hasAttribute("lj-"+b)},hasCssAttributeLJ:function(a,b){return window.getComputedStyle(a,null).getPropertyValue("--lj-"+b)},setAttributeLJ:function(a,b,f){b="lj-"+b;a.getAttribute("data-"+b)?a.setAttribute("data-"+b,f):a.setAttribute(b,f)},setCssAttributeLJ:function(a,b,f){a.style["--lj-"+b]=f},findParentViewOfType:function(a,b){a=a.parentElement;
for(var k=!1;a&&!k;)a._ljView&&a._ljView.type()===b?k=!0:a=a.parentElement;return k?a._ljView:void 0},timeToMS:function(a){if(isFinite(a))return a;a=a&&a.match(/^([\d\.]*)(s|ms|min|h)$/);if(!a)return 0;switch(a[2]){case "ms":return a[1];case "s":return 1E3*a[1];case "min":return 6E4*a[1];case "h":return 36E5*a[1]}return 0},parseDimension:function(a,b){if(!isNaN(Number(a)))return Number(a);if(a.match(/px$/))return parseInt(a);if(a.match(/em$/))return parseInt(a)*parseInt(window.getComputedStyle(b)["font-size"]);
if(a.match(/vh$/))return parseInt(a)*window.innerHeight/100;if(a.match(/vw$/))return parseInt(a)*window.innerWidth/100},uniqueID:function(a,b){b=b||document;void 0===b._ljUniqueHash&&(b._ljUniqueHash={});b=b._ljUniqueHash;a=a||-1;void 0===b[a]&&(b[a]=-1);return-1!==a?a+"["+ ++b[a]+"]":++b[a]},debug:function(){null===d&&(d=document&&document.body&&b.getAttributeLJ(document.body,"debug")?!0:!1);d&&console.log.apply(console,arguments)},splitUrl:function(a){a=a.match(/^([^?#]*)?(?:\?([^#]*))?(?:#(.*))?$/);
return{location:a[1],queryString:a[2],hash:a[3]}},joinUrl:function(a,b){var f=(a.location?a.location:"")+(a.queryString?"?"+a.queryString:"");!0!==b&&(f+=a.hash?"#"+a.hash:"");return f},parseStringForTransitions:function(a,b){var f={};if(a)for(var d in g.transitionParameters)if(g.transitionParameters.hasOwnProperty(d)){var c=new RegExp("(?:^|[?&])"+g.transitionParameters[d]+"=([^&]+)"),n=a.match(c);n&&(f[d]=n[1],!0!==b&&(a=a.replace(c,"")))}return{string:a,transition:f}},getAbsoluteUrl:function(){var a=
document.createElement("a");return function(b){a.href=b;return a.href}}(),_parents:function(a){for(var b=[a];a;a=a.parentNode)b.unshift(a);return b},commonParent:function(a,b){a=this._parents(a);b=this._parents(b);if(a[0]!==b[0])return null;for(var f=0;f<a.length;++f)if(a[f]!==b[f])return a[f-1];return null},getMatrixArray:function(a){a=window.getComputedStyle(a,null);a=a.getPropertyValue("-webkit-transform")||a.getPropertyValue("-moz-transform")||a.getPropertyValue("-ms-transform")||a.getPropertyValue("-o-transform")||
a.getPropertyValue("transform")||"FAIL";if("none"===a||void 0===a||"FAIL"===a)a=[1,0,0,1,0,0];else{a=a.toLowerCase();var b=a.split("(")[1].split(")")[0].split(",").map(function(c){return parseFloat(c.replace(/\s+/g,""))}),f=b[0],d=b[1],c=b[2],n=b[3],q=b[4],e=b[5];a.startsWith("matrix3d(")&&(f=b[0],d=b[1],c=b[4],n=b[5],q=b[12],e=b[13]);a=[f,d,c,n,q,e]}return a},getMatrix:function(a){var b=new f(this.getMatrixArray(a));return b=this.getTopLeftMatrix(a).prod(b)},getScaleAndRotationMatrix:function(a){a=
new f(this.getMatrixArray(a));a.tx=a.ty=0;return a},applyTopLeftOnMatrix:function(a,b){var f=b.get_rotation_equal();f%=360;a=a.getBoundingClientRect();var d=a.width,c=a.height;var n=a.top;var k=a.left;if(0<f&&90>=f||-270>f&&-360<=f)f=f*Math.PI/180*-1,n=a.top,k=a.left-Math.sin(f)*c;else if(90<f&&180>=f||-180>f&&-270<=f)n=(180-f)*Math.PI/180,k=f*Math.PI/180,n=a.top-Math.cos(n)*c*-1,k=a.left+(Math.sin(k)*c+-1*Math.cos(k)*d);else if(0>f&&-90<=f||270<f&&360>=f)f=-f*Math.PI/180,n=a.top+Math.sin(f)*d,k=
a.left;else if(-90>f&&-180<=f||180<f&&270>=f)k=(180-f)*Math.PI/180,n=-f*Math.PI/180,k=a.left+Math.cos(k)*d,n=a.top+(Math.sin(n)*d+-1*Math.cos(n)*c);b.tx=k;b.ty=n;return b}};b.detectBrowser();b.calculatePrefixes(["transform","transform-origin"]);l.exports=b},{"./defaults.js":2,"./tmat.js":31}],4:[function(e,l,h){h=e("./pluginmanager.js");var g=e("./domhelpers.js"),f=e("./baseview.js");e=e("./defaults.js");var d=f.extend({constructor:function(b){this.renderRequiredAttributes="lj-fit-to lj-elastic-left lj-elastic-right lj-elastic-top lj-elastic-bottom lj-width lj-height lj-x lj-y lj-scale-x lj-scale-y lj-rotation lj-start-position".split(" ");
this.transformData=void 0;f.call(this,b);this.originalParent=this.parent},startObserving:function(){f.prototype.observe.call(this,this.innerEl,{attributes:!0,attributeFilter:["name","lj-name","id"].concat(this.renderRequiredAttributes),children:!0,size:!0})},registerEventHandlers:function(){var b=this;f.prototype.registerEventHandlers.call(this);this.on("sizeChanged",function(){b.parent&&(b.inTransition?(b.inTransitionListening||setTimeout(function k(){b.inTransition?setTimeout(k,100):(b.inTransitionListening=
!1,b.trigger("renderRequired",b.name()))},100),b.inTransitionListening=!0):b.trigger("renderRequired",b.name()))});this.on("attributesChanged",this.attributesChanged)},attributesChanged:function(b){for(var a=0;a<this.renderRequiredAttributes.length;a++){var f=Object.getOwnPropertyNames(b);if(-1!==f.indexOf(this.renderRequiredAttributes[a])||-1!==f.indexOf("data-"+this.renderRequiredAttributes[a])){this.trigger("renderRequired",this.name());break}}},getTransformData:function(b,a,f){var d=this.transformData;
if(!d||d.isDirty||d.layer!==b||a&&a!==d.startPosition)return d&&delete d.isDirty,this.unobserve(),this.transformData=this.calculateTransformData(b,a),this.startObserving(),this.transformData;f||(d.scrollX=d.initialScrollX,d.scrollY=d.initialScrollY);return d},getScrollData:function(){return this.transformData?{scrollX:this.transformData.scrollX,scrollY:this.transformData.scrollY}:{}},calculateTransformData:function(b,a){var f=b.parent,d=f?f.width():0,e=f?f.height():0,c=this.transformData={};c.stage=
f;c.layer=b;c.scale=1;c.frameWidth=this.width();c.frameHeight=this.height();c.shiftX=0;c.shiftY=0;c.scrollX=0;c.scrollY=0;c.isScrollX=!1;c.isScrollY=!1;c.margin=this.getMargin();b=this.fitTo(!1)||b.fitTo();-1===["responsive","responsive-width"].indexOf(b)&&this.widthSet()&&(c.frameWidth=this.getOriginalWidth().computedStyleWidth,c.frameOriginalWidth=this.getOriginalWidth().width,this.widthSet(!1));-1===["responsive","responsive-height"].indexOf(b)&&this.heightSet()&&(c.frameHeight=this.getOriginalHeight().computedStyleHeight,
c.frameOriginalHeight=this.getOriginalHeight().height,this.heightSet(!1));switch(b){case "width":c.scale=d/c.frameWidth;c.isScrollY=!0;break;case "height":c.scale=e/c.frameHeight;c.isScrollX=!0;break;case "fixed":c.scale=1;c.isScrollX=!0;c.isScrollY=!0;break;case "contain":c.scaleX=d/c.frameWidth;c.scaleY=e/c.frameHeight;c.scaleX<c.scaleY?(c.scale=c.scaleX,c.isScrollY=!0):(c.scale=c.scaleY,c.isScrollX=!0);break;case "cover":c.scaleX=d/c.frameWidth;c.scaleY=e/c.frameHeight;c.scaleX>c.scaleY?(c.scale=
c.scaleX,c.isScrollY=!0):(c.scale=c.scaleY,c.isScrollX=!0);break;case "elastic-width":d<=c.frameWidth&&d>=c.frameWidth-this.elasticLeft()-this.elasticRight()?(c.scale=1,c.shiftX=this.elasticLeft()*(c.frameWidth-d)/(parseInt(this.elasticLeft())+parseInt(this.elasticRight()))):d>c.frameWidth?c.scale=d/c.frameWidth:(c.scale=d/(c.frameWidth-this.elasticLeft()-this.elasticRight()),c.shiftX=this.elasticLeft());c.isScrollY=!0;break;case "elastic-height":e<=c.frameHeight&&e>=c.frameHeight-this.elasticTop()-
this.elasticBottom()?(c.scale=1,c.shiftY=this.elasticTop()*(c.frameHeight-e)/(parseInt(this.elasticTop())+parseInt(this.elasticBottom()))):e>c.frameHeight?c.scale=e/c.frameHeight:(c.scale=e/(c.frameHeight-this.elasticTop()-this.elasticBottom()),c.shiftY=this.elasticTop());c.isScrollY=!0;break;case "responsive":c.scale=1;c.frameWidth=d;c.applyWidth=!0;c.applyHeight=!0;c.frameHeight=e;break;case "responsive-width":c.scale=1;c.isScrollY=!0;c.applyWidth=!0;c.frameWidth=d;break;case "responsive-height":c.scale=
1;c.isScrollX=!0;c.applyHeight=!0;c.frameHeight=e;break;default:throw"unkown fitTo type '"+b+"'";}if(c.isScrollY&&f.autoWidth())throw"we can't adapt stage width if we fit to width";if(c.isScrollX&&f.autoHeight())throw"we can't adapt stage height if we fit to height";c.width=c.frameWidth*c.scale;c.height=c.frameHeight*c.scale;f&&f.autoWidth()?d=c.width:f&&f.autoHeight()&&(e=c.height);c.maxScrollY=0;c.maxScrollX=0;c.isScrollY&&(c.maxScrollY=c.frameHeight-e/c.scale);c.isScrollX&&(c.maxScrollX=c.frameWidth-
d/c.scale);c.startPosition=a||this.startPosition();a={top:["top","center"],bottom:["bottom","center"],left:["left","middle"],right:["right","middle"],"top-left":["top","left"],"top-right":["top","right"],"bottom-left":["bottom","left"],"bottom-right":["bottom","right"],"middle-center":["middle","center"],middle:["middle","center"],center:["middle","center"]}[c.startPosition];for(f=0;f<a.length;f++)switch(a[f]){case "top":c.isScrollY&&(c.scrollY=0);break;case "bottom":c.isScrollY&&(c.scrollY=c.maxScrollY,
0>c.scrollY&&(c.shiftY=c.scrollY,c.scrollY=0));break;case "left":c.isScrollX&&(c.scrollX=0);break;case "right":c.isScrollX&&(c.scrollX=c.maxScrollX,0>c.scrollX&&(c.shiftX=c.scrollX,c.scrollX=0));break;case "center":c.isScrollX&&(c.scrollX=(c.frameWidth-d/c.scale)/2,0>c.scrollX&&(c.shiftX=c.scrollX,c.scrollX=0));break;case "middle":c.isScrollY&&(c.scrollY=(c.frameHeight-e/c.scale)/2,0>c.scrollY&&(c.shiftY=c.scrollY,c.scrollY=0));break;default:c.isScrollX&&(c.scrollX=0),c.isScrollY&&(c.scrollY=0)}0>=
c.maxScrollX&&(c.shiftX+=c.scrollX,c.scrollX=0,c.maxScrollX=0,c.isScrollX=!1);0>=c.maxScrollY&&(c.shiftY+=c.scrollY,c.scrollY=0,c.maxScrollY=0,c.isScrollY=!1);this.noScrolling()&&(c.shiftX+=c.scrollX,c.shiftY+=c.scrollY,c.scrollX=0,c.scrollY=0,c.isScrollX=!1,c.isScrollY=!1,c.maxScrollX=0,c.maxScrollY=0);c.shiftX*=c.scale;c.shiftY*=c.scale;c.initialScrollX=c.scrollX;c.initialScrollY=c.scrollY;c.frame=this;c.applyWidth&&!this.widthSet()&&(this.setOriginalWidth(),this.widthSet(!0));c.applyHeight&&!this.heightSet()&&
(this.setOriginalHeight(),this.heightSet(!0));return this.transformData=c},width:function(){var b=this.getMargin();b=b.left+b.right;return f.prototype.width.call(this)+b},height:function(){var b=this.getMargin();b=b.top+b.bottom;return f.prototype.height.call(this)+b}},{defaultProperties:{type:"frame"},identify:function(b){b=g.getAttributeLJ(b,"type");return null!==b&&b.toLowerCase()===d.defaultProperties.type}});h.registerType("frame",d,e.identifyPriority.normal);l.exports=d},{"./baseview.js":1,
"./defaults.js":2,"./domhelpers.js":3,"./pluginmanager.js":22}],5:[function(e,l,h){e=e("../../kern/kern.js").Base.extend({constructor:function(){this.buttons=[!1,!1,!1];this.first=this.doubleClick=this.click=this.cancel=!1;this.id=0;this.move=this.last=!1;this.shift={x:0,y:0};this.shiftKey=!1;this.start={x:0,y:0};this.startTime=(new Date).getTime();this.wheel=this.touch=!1;this.wheelDelta=0;this.position={x:0,y:0}},lifeTime:function(){return(new Date).getTime()-this.startTime},enoughDistance:function(){return 10<
Math.abs(this.shift.x)+Math.abs(this.shift.y)}},{});l.exports=e},{"../../kern/kern.js":33}],6:[function(e,l,h){h=e("../../kern/kern.js");var g=e("./gesture.js");e=e("../layerjs.js");h=h.EventManager.extend({constructor:function(){this.element=this.gesture=null;this.gesturecc=0;this.timeoutWheel=null},register:function(f,d,b){b=b||{};this._registerTouchEvents(f,d,b);this._registerWheelEvents(f,d,b)},_registerWheelEvents:function(f,d,b){var a=this;f.addEventListener("wheel",function(k){return a._wheel(k,
f,d,b)})},_registerTouchEvents:function(f,d,b){var a=this,k=function(c){return a._tap(c,f,d,b)},e=function(c){return a._drag(c,f,d,b)},m=function(c){return a._release(c,f,d,b)};"undefined"!==typeof window.ontouchstart&&(f.addEventListener("touchstart",k),f.addEventListener("touchend",m),b.dragging&&f.addEventListener("touchmove",e));b.mouseDragging&&(f.addEventListener("mousedown",k),f.addEventListener("mouseup",m),b.dragging&&f.addEventListener("mousemove",e))},_wheel:function(f,d,b,a){this.timeoutWheel&&
clearTimeout(this.timeoutWheel);this.gesture=new g;this.gesture.wheel=!0;this.gesture.first=!0;this.gesture.start.x=this.gesture.position.x=this._xPosition(f);this.gesture.start.y=this.gesture.position.y=this._yPosition(f);this.element=d;this._raiseGesture(f,b);this.gesture.first=!1;this.gesture.wheelDelta=this._wheelDelta(f);this.gesture.position={x:this.gesture.position.x+6*this.gesture.wheelDelta.x,y:this.gesture.position.y+6*this.gesture.wheelDelta.y};this.gesture.shift={x:this.gesture.position.x-
this.gesture.start.x,y:this.gesture.position.y-this.gesture.start.y};this.gesture.last=!0;this._raiseGesture(f,b);return!1},_wheelDelta:function(f){var d={x:0,y:0};void 0!==f.deltaY&&void 0!==f.deltaX?(d.y=-f.deltaY/3,d.x=-f.deltaX/3):void 0!==f.wheelDeltaY&&void 0!==f.wheelDeltaX?(d.y=-f.wheelDeltaY/120,d.x=-f.wheelDeltaX/120):void 0!==f.detail&&(d.Y=-f.detail/3);return d},_tap:function(f,d,b,a){this.element=d;this.gesture=new g;this.gesture.first=!0;this.gesture.start.x=this._xPosition(f);this.gesture.start.y=
this._yPosition(f);this.gesture.touch="mousedown"!==f.type;this.gesture.click="mousedown"===f.type;this._raiseGesture(f,b);return!1},_release:function(f,d,b,a){this.gesture.move=!1;this.gesture.last=!0;this.gesture.position.x=this._xPosition(f);this.gesture.position.y=this._yPosition(f);this.gesture.shift.x=this.gesture.position.x-this.gesture.start.x;this.gesture.shift.y=this.gesture.position.y-this.gesture.start.y;this._raiseGesture(f,b);this.gesture=this.element=null;return!1},_drag:function(f,
d,b,a){null!==this.gesture&&(this.gesture.click||this.gesture.touch)&&(this.gesture.first=!1,this.gesture.move=!0,this.gesture.position.x=this._xPosition(f),this.gesture.position.y=this._yPosition(f),this.gesture.shift.x=this.gesture.position.x-this.gesture.start.x,this.gesture.shift.y=this.gesture.position.y-this.gesture.start.y,this._raiseGesture(f,b));return!1},_yPosition:function(f){return f.targetTouches&&1<=f.targetTouches.length?f.targetTouches[0].clientY:f.changedTouches&&1<=f.changedTouches.length?
f.changedTouches[0].clientY:f.clientY},_xPosition:function(f){return f.targetTouches&&1<=f.targetTouches.length?f.targetTouches[0].clientX:f.changedTouches&&1<=f.changedTouches.length?f.changedTouches[0].clientX:f.clientX},_raiseGesture:function(f,d){if(d&&this.gesture){this.gesture.event=f;if(!this.gesture.direction){var b=this.gesture.shift.x,a=this.gesture.shift.y;this.gesture.enoughDistance()&&(Math.abs(b)>Math.abs(a)?(this.gesture.direction=0>b?"left":"right",this.gesture.axis="x"):(this.gesture.direction=
0>a?"up":"down",this.gesture.axis="y"))}d(this.gesture);this.gesture.preventDefault&&(f.preventDefault(),f.stopPropagation());this.gesture.cancelled&&(this.gesture=this.element=null)}}});e.gestureManager2=new h;l.exports=e.gestureManager2},{"../../kern/kern.js":33,"../layerjs.js":7,"./gesture.js":5}],7:[function(e,l,h){h=e("./domhelpers.js");var g=e("./defaults.js");e("./polyfill.js");layerJS={select:h.selectView,imagePath:"/",executeScriptCode:!0,defaults:g};l.exports=layerJS},{"./defaults.js":2,
"./domhelpers.js":3,"./polyfill.js":23}],8:[function(e,l,h){var g=e("./domhelpers.js"),f=e("../kern/Kern.js");h=e("./pluginmanager.js");var d=e("./layoutmanager.js"),b=e("./scrolltransformer.js"),a=e("./gestures/gesturemanager.js"),k=e("./defaults.js"),p=e("./baseview.js"),m=p.extend({constructor:function(c){c=c||{};c.childType="frame";this.transitionQueue=new f.Queue;this.innerEl=this.outerEl=c.el;1===this.outerEl.children.length&&"scroller"===g.getAttributeLJ(this.outerEl.children[0],"helper")&&
(this.innerEl=this.outerEl.children[0]);p.call(this,c);this._inTransition=!1;this.scrollID=this.transitionID=this._transitionIDcounter=1;this.currentFrame=null;this.switchLayout(this.layoutType());this.switchScrolling(this.nativeScroll());a.register(this.outerEl,this.gestureListener.bind(this),{dragging:!0,mouseDragging:this.draggable()});var b=this;this.onResizeCallBack=function(){b.render()};this.stage=this.parent;this.on("scroll",function(){this.trigger("scrolled")});var d;(c=this.defaultFrame())&&
c!==k.specialFrames.none&&((d=this._getFrame(c)||null)||console.warn("layerJS: layer '"+this.name()+"': could not find defaultframe: '"+c+"'"));d||c===k.specialFrames.none||(d=this._getFrame(k.specialFrames.next)||null);this.currentFrameTransformData=this.noFrameTransformdata();d?(this.currentFrame=d,this.showFrame(d.name(),{lastFrameName:"",applyCurrentPostPosition:!1})):(this.currentFrame=null,this.showFrame(k.specialFrames.none,{lastFrameName:""}));this.autoTrigger()},startObserving:function(){p.prototype.observe.call(this,
this.innerEl,{attributes:!0,attributeFilter:"name lj-name id lj-layout-type lj-native-scroll lj-no-scrolling".split(" "),children:!0})},registerEventHandlers:function(){var c=this;p.prototype.registerEventHandlers.call(this);this.on("attributesChanged",this.attributesChanged);if(this.parent)this.parent.on("renderRequired",function(){c.render()});this.on("transitionStarted",function(){c.autoTrigger()})},attributesChanged:function(c){(c["lj-native-scroll"]||-1!==c["data-lj-native-scroll"])&&this.switchScrolling(this.nativeScroll());
-1===c["lj-layout-type"]&&-1===c["data-lj-layout-type"]||this.switchLayout(this.layoutType());-1===c["lj-timer"]&&-1===c["data-lj-timer"]||this.autoTrigger()},autoTrigger:function(){var c=this.timer();c&&(c.match(/^[0-9]/)&&(c="#!next&d="+c),layerJS.router.navigate(c,this))},renderChildPosition:function(c){this._layout||this.switchLayout(this.layoutType());this._layout.renderFramePosition(c,this._currentTransform)},inTransition:function(c,a){if(c){var b=this;c=a&&a.duration?50+Number.parseFloat(a.duration):
0;this._inTransitionTimestamp=Date.now();this._inTransitionDuration=c;this._intransitionID=a.transitionID;this._inTransition=!0;0<c&&setTimeout(function(){b._transitionEnd(a)},c)}else!1===c&&this.transitionID===this._intransitionID&&(delete this._inTransitionTimestamp,delete this._inTransitionDuration,delete this._intransitionID,this._inTransition=!1);return this._inTransition},getRemainingTransitionTime:function(){return this._inTransition?Math.max(1,this._inTransitionDuration-(Date.now()-this._inTransitionTimestamp)-
50):!1},switchScrolling:function(c){this.unobserve();var a=1===this.outerEl.children.length&&"scroller"===g.getAttributeLJ(this.outerEl.children[0],"helper");c?(this.innerEl=a?this.outerEl.children[0]:g.wrapChildren(this.outerEl),g.setAttributeLJ(this.innerEl,"helper","scroller"),this.innerEl._ljView||(this.innerEl._ljView=this.outerEl._ljView,this.innerEl._state=this.outerEl._state),g.addClass(this.outerEl,"nativescroll")):(a&&g.unwrapChildren(this.outerEl),this.innerEl=this.outerEl,g.removeClass(this.outerEl,
"nativescroll"));this._transformer=this._layout.getScrollTransformer()||new b(this);this.setNativeScroll(c);this.currentFrame&&this.showFrame(this.currentFrame.name(),this.currentFrame.getScrollData());this.startObserving()},getCurrentScroll:function(){return{scrollX:this.currentFrameTransformData.scrollX,scrollY:this.currentFrameTransformData.scrollY}},scrollTo:function(c,a,b){if(null!==this.currentFrame){b=b||{};b.startPosition&&(this.currentFrameTransformData=this.currentFrame.getTransformData(this,
b.startPosition));var d=this.currentFrameTransformData;"object"===typeof c&&(b=c,c=0);c=void 0!==c?c:void 0!==b.scrollX?b.scrollX:d.scrollX||0;a=void 0!==a?a:void 0!==b.scrollY?b.scrollY:d.scrollY||0;b.scrollX=c;b.scrollY=a;b=f._extend({lastFrameName:this.currentFrame.name(),applyTargetPrePosition:!1,applyCurrentPostPosition:!1,applyCurrentPrePosition:!1,duration:"",type:"none"},b||{});return this.transitionTo(this.currentFrame.name(),b)}},switchLayout:function(a){this._layout=new (d.get(a))(this);
this._transformer=this._layout.getScrollTransformer()||new b(this);this.currentFrame&&this.render()},setLayerTransform:function(a,b){var c=0;b&&b.transition&&(c=g.timeToMS(b.transition));c=this.inTransition()?Math.max(this.getRemainingTransitionTime(),c):c;return this._layout.setLayerTransform(a,{transition:c?c+"ms":""})},gestureListener:function(a){if(!a.event._ljEvtHndld||a.event._ljEvtHndld===this)if(a.event._ljEvtHndld=this,null!==this.currentFrame){var c=this._transformer.scrollGestureListener(a);
a.first||("wheel"===a.event.type&&(a.preventDefault=!0),!0===c?a.preventDefault=!1:c?(this.setLayerTransform(this.currentTransform=c),this.trigger("scrolled"),a.preventDefault=!0):(this.inTransition()&&(a.preventDefault=!0),c=this.currentFrame.neighbors(),a.direction?c&&c[k.directions2neighbors[a.direction]]?(a.preventDefault=!0,!this.inTransition()&&(a.last||a.wheel&&a.enoughDistance())&&this.transitionTo(c[k.directions2neighbors[a.direction]],{type:k.neighbors2transition[k.directions2neighbors[a.direction]]})):
(a.preventDefault=!1,g.debug(a.direction),!c||!c.l&&!c.r||"left"!==a.direction&&"right"!==a.direction||(a.preventDefault=!0)):(a.event.stopPropagation(),a.preventDefault=!0)))}},showFrame:function(a,b){if(this.stage)return b=f._extend({scrollX:0,scrollY:0,lastFrameName:this.currentFrame&&this.currentFrame.name()||k.specialFrames.none,applyTargetPrePosition:!1,applyCurrentPostPosition:this.currentFrame?a!==this.currentFrame.name()&&a!==k.specialFrames.current:!1,applyCurrentPrePosition:!1,duration:"",
type:"none"},b||{}),this.transitionTo(a,b)},noFrameTransformdata:function(a){if(this._noframetd&&this._noframetd.startPosition===a)return this._noframetd;var c=this._noframetd={};c.stage=this.stage;c.scale=1;c.width=this.stage?this.stage.width():0;c.height=this.stage?this.stage.height():0;c.frameWidth=0;c.frameHeight=0;var b=this.fitTo();switch(b){case "width":case "elastic-width":case "responsive-width":c.frameWidth=c.width;break;case "height":case "elastic-height":case "responsive-height":c.frameHeight=
c.height;break;case "fixed":case "responsive":case "contain":case "cover":c.frameWidth=c.width;c.frameHeight=c.height;break;default:throw"unkown fitTo type '"+b+"'";}this.stage&&this.stage.autoHeight()&&(c.height=c.frameHeight=0);this.stage&&this.stage.autoWidth()&&(c.width=c.frameWidth=0);c.shiftX=c.shiftY=c.scrollX=c.scrollY=0;c.isScrollX=c.isScrollY=!1;c.startPosition=a||"top";c.initialScrollX=c.scrollX;c.initialScrollY=c.scrollY;return c},transitionTo:function(a,b){var c=this;b=b||{};"object"===
typeof a&&null!==a?(b=a,a=b.framename):null!==a&&(a=a||b&&b.framename);var d=b.groupId||(b.groupId=g.uniqueID("group")),e=this.lastgroupId!==d;this.lastgroupId=d;if(b.delay)b.semaphore&&b.semaphore.skip(),setTimeout(function(){b.groupId===c.lastgroupId&&(delete b.semaphore,delete b.delay,delete b.transitionID,c.transitionTo(a,b))},g.timeToMS(b.delay));else{var m=function(){if(!a&&null!==a)throw"transformTo: no frame given";var d=a?c._getFrame(a,b):null;if(!d&&null!==d)throw"transformTo: "+a+" does not exist in layer";
d&&null!==d&&(a=d.name());if(b&&b.type&&b.type.match(/^auto:/)){var e=b.type.replace(/^auto:/,"");delete b.type}b=f._extend({type:b&&b.type?"default":d&&d.defaultTransition()||c.defaultTransition()||e||"default",previousType:b&&b.type?void 0:c.currentFrame&&c.currentFrame.defaultTransition()||void 0,duration:k.defaultDuration,lastFrameName:c.currentFrame&&c.currentFrame.name()||k.specialFrames.none,frame:d,framename:a,applyTargetPrePosition:!b.noActivation&&(b.applyTargetPrePosition||d&&d.parent&&
d.parent===c)||!1,interStage:d&&d.parent&&d.parent!==c,applyCurrentPostPosition:!0!==b.applyCurrentPostPosition&&c.currentFrame&&c.currentFrame.parent&&c.currentFrame.parent===c&&!b.noActivation||!1,applyCurrentPrePosition:!0!==b.applyCurrentPrePosition&&c.currentFrame&&c.currentFrame.parent&&c.currentFrame.parent===c&&!b.noActivation||!1},b||{});b.type&&b.type.match(/^(?:r:|reverse:)/i)&&(b.type=b.type.replace(/^(?:r:|reverse:)/i,""),b.reverse=!0);b.previousType&&b.previousType.match(/^(?:r:|reverse:)/i)&&
(b.previousType=b.previousType.replace(/^(?:r:|reverse:)/i,""),b.previousReverse=!0);b.semaphore||(b.semaphore=(new f.Semaphore).register());b.semaphore.listen(!0).then(function(a){0<a&&(!1!==b.applyTargetPrePosition||b.interStage)&&c.trigger("transitionPrepared")});b.semaphore.listen().then(function(){c.updateClasses();c.transitionQueue.continue()});c.inTransition()&&(b.wasInTransition=!0);b.duration=Math.max(c.getRemainingTransitionTime()||0,g.timeToMS(b.duration)||0)+"ms";"0ms"===b.duration&&(b.duration=
"");c.trigger("beforeTransition",a);b.transitionID=c.transitionID=++c._transitionIDcounter;c.inTransition(!0,b);g.debug("running new transition",b.transitionID,b,a,c.id());return c._layout.loadFrame(d).then(function(){var e=c.getCurrentScroll(),k=b.targetFrameTransformData=null===d?c.noFrameTransformdata(b.startPosition):d.getTransformData(c,b.startPosition),m=c._transformer.getScrollTransform(k,b,!0);if(c.currentFrame===d&&c.currentFrameTransformData===k)if(k.scrollX!==e.scrollX||k.scrollY!==e.scrollY)b=
f._extend(b,{applyTargetPrePosition:!1,applyCurrentPostPosition:!1,applyCurrentPrePosition:!1,scrollX:k.scrollX,scrollY:k.scrollY,type:"none"});else{var n=new f.Promise;c.trigger("transitionStarted",a,b);b.semaphore.sync().then(function(){b.wasInTransition||(c.trigger("transitionFinished",a),c.inTransition(!1));n.resolve()});return n}d&&(d.inTransition=!0);e=c._layout.transitionTo(d,b,k,m).then(function(){c._transitionEnd(b)});b.noActivation||(c.currentFrameTransformData=k,c.currentFrame=d,c.currentTransform=
m);c.trigger("transitionStarted",a,b);return e})};return e?this.transitionQueue.add(b.isEvent&&"event").then(function(){try{return m()}catch(r){throw c.transitionQueue.continue(),r;}}):m()}},_transitionEnd:function(a){var c=this;a.transitionID===this.transitionID&&(g.debug("transition finished",a.transitionID),a.noActivation||(this.currentTransform=this._transformer.getScrollTransform(a.targetFrameTransformData||{},a,!1)),this.inTransition(!1),a.noActivation||this.setLayerTransform(this.currentTransform),
this.updateClasses(),a.frame&&(a.frame.inTransition=!1),g.postAnimationFrame(function(){c.trigger("transitionFinished",a.framename)}))},_getFrame:function(a,b){if(a===k.specialFrames.left||a===k.specialFrames.right||a===k.specialFrames.top||a===k.specialFrames.bottom)if(null!==this.currentFrame){var c=this.currentFrame.neighbors();b=b||{};c&&c.l&&a===k.specialFrames.left?a=c.l:c&&c.r&&a===k.specialFrames.right?a=c.r:c&&c.t&&a===k.specialFrames.top?a=c.t:c&&c.b&&a===k.specialFrames.bottom?a=c.b:b.type!==
k.neighbors2transition.r||a!==k.specialFrames.left||(!c||c.l)&&c?b.type!==k.neighbors2transition.l||a!==k.specialFrames.right||(!c||c.r)&&c?b.type!==k.neighbors2transition.b||a!==k.specialFrames.bottom||(!c||c.u)&&c?b.type!==k.neighbors2transition.u||a!==k.specialFrames.top||(!c||c.b)&&c?c||(a=k.specialFrames.next):a=k.specialFrames.next:a=k.specialFrames.previous:a=k.specialFrames.previous:a=k.specialFrames.next}else null===this.currentFrame&&(a!==k.specialFrames.previous?a=k.specialFrames.next:
a!==k.specialFrames.next&&(a=k.specialFrames.previous));a===k.specialFrames.toggle&&(a=null===this.currentFrame?k.specialFrames.next:k.specialFrames.none);a===k.specialFrames.next?a=this._getNextFrameName():a===k.specialFrames.previous?a=this._getPreviousFrameName():a===k.specialFrames.current&&(a=null!==this.currentFrame?this.currentFrame.name():k.specialFrames.none);if(a===k.specialFrames.none)b=null;else if(b=this.getChildViewByName(a),void 0===b&&void 0!==a){a=layerJS.getState().resolvePath(a);
if(1<a.length)throw"only 1 path should be expected";0<a.length&&(b=a[0].view)}return b},_getNextFrameName:function(){var a=this.getChildViews();if(null===this.currentFrame&&0<a.length)var b=a[0].name();else if(null!==this.currentFrame&&0<a.length){for(b=0;b<a.length&&this.currentFrame.name()!==a[b].name();b++);b=b+1<a.length?a[b+1].name():a[0].name()}return b},_getPreviousFrameName:function(){var a=this.getChildViews();if(null===this.currentFrame&&0<a.length)var b=a[0].name();else if(null!==this.currentFrame&&
0<a.length){for(var d=a.length-1;0<=d&&this.currentFrame.name()!==a[d].name();d--);0===d?b=a[a.length-1].name():0<d&&(b=a[d-1].name())}return b},getCurrentTransform:function(){return this.currentTransform},updateClasses:function(){for(var a=this.getChildViews(),b=a.length,d=0;d<b;d++)g.removeClass(a[d].outerEl,"lj-active"),g.removeClass(a[d].outerEl,"lj-transition");null!==this.currentFrame&&g.addClass(this.currentFrame.outerEl,"lj-active");for(d=0;d<arguments.length;d++)arguments[d]&&arguments[d].outerEl&&
g.addClass(arguments[d].outerEl,"lj-transition")},_renderChildPosition:function(a){this._layout||this.switchLayout(this.layoutType());a.unobserve();this._layout.renderFramePosition(a,this.currentTransform);a.startObserving()},render:function(){var a=this.getChildViews(),b=a.length,d=null!==this.currentFrame?this.currentFrame.getScrollData():{};d.isEvent=!0;for(var f=0;f<b;f++){var e=a[f];void 0!==e.transformData&&(e.transformData.isDirty=!0)}this.showFrame(k.specialFrames.current,d)},_parseChildren:function(a){p.prototype._parseChildren.call(this,
a);var b=this._cache.children,c=this;a&&a.removedNodes&&0<a.removedNodes.length&&a.removedNodes.forEach(function(a){a._ljView&&a._ljView.off("renderRequired",void 0,c)});if(a&&a.addedNodes&&0<a.addedNodes.length){b=[];for(var d=0;d<a.addedNodes.length;d++)a.addedNodes[d]._ljView&&b.push(a.addedNodes[d]._ljView)}a=function(a){c.currentFrame&&null!==c.currentFrame&&c.currentFrame.name()===a&&(c._renderChildPosition(c._cache.childNames[a]),c.render())};for(d=0;d<b.length;d++)b[d].on("renderRequired",
a,{context:this})}},{defaultProperties:{type:"layer"},identify:function(a){a=g.getAttributeLJ(a,"type");return null!==a&&a.toLowerCase()===m.defaultProperties.type}});h.registerType("layer",m,k.identifyPriority.normal);l.exports=m},{"../kern/Kern.js":32,"./baseview.js":1,"./defaults.js":2,"./domhelpers.js":3,"./gestures/gesturemanager.js":6,"./layoutmanager.js":9,"./pluginmanager.js":22,"./scrolltransformer.js":28}],9:[function(e,l,h){h=e("./layerjs.js");var g=e("../kern/Kern.js");e=g.EventManager.extend({constructor:function(f){g.EventManager.call(this);
this.map=f||{}},registerType:function(f,d){this.map[f]=d},get:function(f){return this.map[f]}});h.layoutManager=new e;l.exports=h.layoutManager},{"../kern/Kern.js":32,"./layerjs.js":7}],10:[function(e,l,h){var g=e("../domhelpers.js"),f=e("../../kern/Kern.js");h=e("../layoutmanager.js");var d=e("./layerlayout.js");e=d.extend({constructor:function(b){d.call(this,b);this._frameTransforms={}},transitionTo:function(b,a,d,e){var k=new f.Promise,c=this,g=this.layer.getChildViews(),p=g.length,h,l=a.noActivation?
b:g[p-1],z=function(){if(a.transitionID===c.layer.transitionID)for(var d=0;d<(a.noActivation?p:1);d++)h=a.noActivation?b:g[d],h.applyStyles({transition:"none"});k.resolve()};""!==a.duration&&l.outerEl.addEventListener("transitionend",function t(a){l.outerEl===a.target&&(a.target.removeEventListener(a.type,t),z())});a.semaphore.sync().then(function(){if(null!==b){var f=function(b){var d=b.getTransformData(c.layer),f={transition:a.duration,opacity:1,display:"block"};f.width=d.applyWidth?d.frameWidth-
d.margin.left-d.margin.right+"px":d.frameOriginalWidth;f.height=d.applyHeight?d.frameHeight-d.margin.top-d.margin.bottom+"px":d.frameOriginalHeight;c._applyTransform(b,c._reverseTransform,e,f)};if(a.noActivation)f(b);else{c._reverseTransform=c._calculateReverseTransform(b,d);for(var k=0;k<p;k++)f(g[k])}}else for(f=0;f<p;f++)h=g[f],h.applyStyles({opacity:0,transition:a.duration});""===a.duration&&z()});return k},_calculateReverseTransform:function(b,a){var d=parseInt(b.x(),10)||0,f=parseInt(b.y(),
10)||0,e=b.rotation()||0;this._currentRotation&&(e>this._currentRotation+180&&(e-=360*(1+Math.floor((e-this._currentRotation)/360))),e<this._currentRotation-180&&(e+=360*(1+Math.floor((this._currentRotation-e)/360))));this._currentRotation=e;return"translate3d("+parseInt(-a.shiftX,10)+"px,"+parseInt(-a.shiftY,10)+"px,0px) scale("+a.scale/(b.scaleX()||1)+","+a.scale/(b.scaleY()||1)+") rotate("+(-e||0)+"deg)  translate3d("+-d+"px,"+-f+"px,0px)"},setLayerTransform:function(b,a){var d=this.layer.getChildViews(),
e=d.length,m=new f.Promise;a.transition?this.layer.currentFrame.outerEl.addEventListener("transitionend",function v(a){a.target.removeEventListener(a.type,v);m.resolve()}):m.resolve();for(var c=0;c<e;c++){var g=d[c];this._applyTransform(g,this._reverseTransform,b,a)}return m},renderFramePosition:function(b,a){d.prototype.renderFramePosition.call(this,b,a);delete this._frameTransforms[b.id()];this._reverseTransform&&a&&this._applyTransform(b,this._reverseTransform,this.layer.currentTransform,{})},
_applyTransform:function(b,a,d,f){f=f||{};var e=b.x(),c=b.y();void 0!==e&&(f.left=g.parseDimension(e)+"px");void 0!==c&&(f.top=g.parseDimension(c)+"px");b.applyStyles(f||{},{transform:"translate3d("+(-b.x()||0)+"px,"+(-b.y()||0)+"px,0px)"+d+" "+a+" "+(this._frameTransforms[b.id()]="translate3d("+(b.x()||0)+"px,"+(b.y()||0)+"px,0px) rotate("+(b.rotation()||0)+"deg) scale("+b.scaleX()+","+b.scaleY()+")")})}});h.registerType("canvas",e);l.exports=e},{"../../kern/Kern.js":32,"../domhelpers.js":3,"../layoutmanager.js":9,
"./layerlayout.js":11}],11:[function(e,l,h){var g=e("../domhelpers.js"),f=e("../../kern/Kern.js"),d=e("../tmat.js");e=f.EventManager.extend({constructor:function(b){f.EventManager.call(this);if(!b)throw"provide a layer";this.layer=b},renderFramePosition:function(b){b.x();b.y();b.width();b.height()},loadFrame:function(b){var a=new f.Promise,e=null!==b&&b.document.defaultView&&b.document.defaultView.getComputedStyle||function(a){return a.style};if(null===b||b.document.body.contains(b.outerEl)&&"none"!==
e(b.outerEl).display&&b.parent===this.layer)a.resolve();else{if(b.parent!==this.layer){e=this.layer.outerEl;var p=g.commonParent(b.innerEl,e),m=function(a,b){var c=new d;a!==b&&(c=m(a.parentNode,b));a=g.getScaleAndRotationMatrix(a);return c.prod(a)},c=m(b.outerEl,p);c=g.applyTopLeftOnMatrix(b.outerEl,c);p=m(e,p);p=g.applyTopLeftOnMatrix(e,p);e=p.invert().prod(c);b.parent.currentFrame===b&&(b.parent.currentFrame=null);this.layer.innerEl.appendChild(b.outerEl);b.transformData=void 0;b.applyStyles({transform:e.transform_nomatrix(),
top:"0px",left:"0px"});g.debug("moved "+b.id()+" to layer "+this.layer.id())}else b.outerEl.style.display="block",b.outerEl.style.opacity="0";g.postAnimationFrame(function(){a.resolve()})}return a},getStageWidth:function(){return this.layer.stage.width()},getStageHeight:function(){return this.layer.stage.height()},transitionTo:function(){throw"transitionTo() not implemented";},prepareTransition:function(){},parametricTransition:function(){throw"parametricTransition() not implemented";},getScrollTransformer:function(){}});
l.exports=e},{"../../kern/Kern.js":32,"../domhelpers.js":3,"../tmat.js":31}],12:[function(e,l,h){var g=e("../domhelpers.js"),f=e("../../kern/Kern.js");h=e("../layoutmanager.js");var d=e("./layerlayout.js"),b=["adjacent",0,0,1,0];e=["adjacent",-1,0,1,0];var a=["adjacent",1,0,1,0],k=["adjacent",0,1,1,0],p=["adjacent",0,-1,1,0],m=["adjacent",0,0,1,0,{opacity:0}],c=["adjacent",0,0,1,0,{filter:"blur(5px)",opacity:0},{filter:"blur(0px)"}],n=["adjacent",0,0,.666,0,{opacity:0}],q=["adjacent",0,0,1.5,0,{opacity:0}],
A={default:[a,e,1],none:[b,b,1],left:[a,e,1],right:[e,a,1],up:[k,p,1],down:[p,k,1],fade:[m,m,-1],blur:[c,c,-1],slideOverLeft:[a,b,1],slideOverRight:[e,b,1],slideOverUp:[k,b,1],slideOverDown:[p,b,1],slideOverLeftFade:[a,m,1],slideOverRightFade:[e,m,1],slideOverUpFade:[k,m,1],slideOverDownFade:[p,m,1],zoomout:[q,n,1],zoomin:[n,q,-1],inouttop:[p,p,1],inoutleft:[e,e,1],inoutright:[a,a,1],inoutbottom:[k,k,1]};e=d.extend({constructor:function(a){d.call(this,a);this._preparedTransitions={}},hideOtherFrames:function(a,
b){for(var c=this.layer.getChildViews(),d=0;d<c.length;d++)c[d]!==b&&c[d]!==a&&null!==c[d].outerEl.parentNode&&c[d].applyStyles({display:"none"})},transitionTo:function(a,b,c,d){var e=this,k=e.layer.currentFrame;return this.prepareTransition(a,b,c,d).then(function(m){var p=new f.Promise,n=0,q=function(a,c){a.transitionID&&b.transitionID!==a.transitionID||(a.applyStyles(m.fix_css,c?{transition:"none",display:"none","z-index":"initial"}:{transition:"none","z-index":"initial"}),g.debug("slidelayout: fix "+
(c?"c":"t")));n--;0===n&&p.resolve()};b.semaphore.sync().then(function(){var f={transition:b.duration,top:"0px",left:"0px",opacity:"1",width:c.frameOriginalWidth,height:c.frameOriginalHeight};c.applyWidth&&(f.width=c.frameWidth-c.margin.left-c.margin.right+"px");c.applyHeight&&(f.height=c.frameHeight-c.margin.top-c.margin.bottom+"px");a&&(a.transitionID=b.transitionID);a&&""!==b.duration&&(a.outerEl.addEventListener("transitionend",function B(c){c.target===a.outerEl&&(c.target.removeEventListener(c.type,
B),q(a,!!b.noActivation))}),n++);b.noActivation?e._applyTransform(a,{opacity:0,transition:b.duration},{},{}):e._applyTransform(a,e._currentFrameTransform=m.t1,d,f);g.debug("slidelayout: apply t1");!1!==b.applyCurrentPostPosition&&(k&&(k.transitionID=b.transitionID),k&&""!==b.duration&&(k.outerEl.addEventListener("transitionend",function B(a){a.target===k.outerEl&&(a.target.removeEventListener(a.type,B),q(k,!0))}),n++),e._applyTransform(k,m.c1,d,{transition:b.duration,top:"0px",left:"0px"}),g.debug("slidelayout: apply c1"));
""===b.duration&&(n=k&&k!==a&&a?2:1,k&&k!==a&&q(k,!0),a&&q(a));e._preparedTransitions={}});return p})},prepareTransition:function(a,c,d,e){var k=new f.Promise,m,p=this.layer.currentFrame;c.wasInTransition||this.hideOtherFrames(a,p);a&&(m=this._preparedTransitions[a.id()])&&(m.transform===e&&m.applied?k.resolve(m):m=void 0);if(!m){var n=A[c.type];!n&&c.type&&c.type.match(/:/)?n=c.type.split(":"):n||(n=[b,b,1]);if("function"===typeof n)m=n(c.type,this.layer.currentFrameTransformData,d);else if(Array.isArray(n)){n=
c.reverse?[n[1],n[0],this.layer.currentFrameTransformData,d,n[2]&&-n[2]||0]:[n[0],n[1],this.layer.currentFrameTransformData,d,n[2]];if(c.previousType){var q=A[c.previousType];Array.isArray(q)&&(n[1]=c.previousReverse?q[1]:q[0])}m=this.genericTransition.apply(this,n)}else throw"slidelayout: error in registered transition type.";m.transform=e;if(!1===c.applyTargetPrePosition&&!1===c.applyCurrentPrePosition)return k.resolve(m),k;if(null===a&&!m.current_css)return m.applied=!0,k.resolve(m),k;e={transition:"none",
visibility:"inital"};e.width=d.applyWidth?d.frameWidth-d.margin.left-d.margin.right+"px":d.frame.getOriginalWidth()+"px";d.applyHeight&&(e.height=d.frameHeight-d.margin.top-d.margin.bottom+"px");!1!==c.applyTargetPrePosition&&(this._applyTransform(a,m.t0,this.layer.currentTransform,e),g.debug("slidelayout: apply t0"));p&&m.current_css&&!1!==c.applyCurrentPrePosition&&(this._applyTransform(p,m.c0,this.layer.currentTransform,{transition:"none","z-index":"initial"}),g.debug("slidelayout: apply c0"));
g.postAnimationFrame(function(){m.applied=!0;k.resolve(m)})}return k},setLayerTransform:function(a,b){b=b||{};var c=new f.Promise;b.transition?this.layer.currentFrame.outerEl.addEventListener("transitionend",function u(a){a.target.removeEventListener(a.type,u);c.resolve()}):c.resolve();this._applyTransform(this.layer.currentFrame,this._currentFrameTransform,a,b);return c},_applyTransform:function(a,b,c,d){a&&(b=f._extend({},b),b.transform=c+" "+(b.transform||""),a.applyStyles({left:"0px",top:"0px"},
d||{},b))},_calcFrameTransform:function(a){return{transform:"translate3d("+-a.shiftX+"px,"+-a.shiftY+"px,0px) scale("+a.scale+")",opacity:1}},genericTransition:function(a,b,c,d,e){var k=this,m=function(a,b,c,d){var e=k.getStageWidth(),m=k.getStageHeight(),g=-b.shiftX,n=-b.shiftY,p=-c.shiftX,q=-c.shiftY,h=a[1],l=a[2],A=a[3],t=a[4],v=a[5]||{};switch(a[0]){case "adjacent":return p=0>h?p+(Math.min(g,0)-c.width-p)*Math.abs(h):p+(Math.max(g+b.width,e)-p)*Math.abs(h),q=0>l?q+(Math.min(n,0)-c.height-q)*Math.abs(l):
q+(Math.max(n+b.height,m)-q)*Math.abs(l),0===h&&(p+=-c.scrollX*c.scale+b.scrollX*b.scale),0===l&&(q+=-c.scrollY*c.scale+b.scrollY*b.scale),f._extend({transform:"translate3d("+p+"px,"+q+"px,"+d+"px) scale("+c.scale*A+") rotate("+t+"deg)",opacity:1,"z-index":d},v)}},g=a[6]||{},n=b[6]||{};g={t1:f._extend(this._calcFrameTransform(d),g),c0:f._extend(this._calcFrameTransform(c),n)};Object.keys(n).length&&(g.current_css=!0);g.t0=m(a,c,d,e||0);g.c1=m(b,d,c,e&&-e||0);g.fix_css=[a[5],b[5],a[6],b[6]].map(function(a){return Object.keys(a||
{})}).reduce(function(a,b){"transform"!==b&&""!==b&&(a[b]="initial");return a},{});return g}});h.registerType("slide",e);l.exports=e},{"../../kern/Kern.js":32,"../domhelpers.js":3,"../layoutmanager.js":9,"./layerlayout.js":11}],13:[function(e,l,h){var g=e("./observer.js");e=g.extend({constructor:function(f,d){this.attributes={};g.call(this,f,d)},_initalizeAttributes:function(){this.attributes={};for(var f=this.element.attributes.length,d=0;d<f;d++){var b=this.element.attributes[d];this.attributes[b.name]=
b.value}},_invokeCallBack:function(f){if(this.options.attributeFilter&&f.attributes&&0<Object.getOwnPropertyNames(f.attributes).length){var d={},b;for(b in f.attributes)if(f.attributes.hasOwnProperty(b))for(var a=b.toUpperCase(),e=0;e<this.options.attributeFilter.length;e++){var g=this.options.attributeFilter[e].toUpperCase(),m=g===a||g.endsWith("*")&&a.startsWith(g.slice(0,-1));!m&&g.startsWith("LJ-")&&(g="DATA-"+g,m=g===a||g.endsWith("*")&&a.startsWith(g.slice(0,-1)));m&&(d[b]=f.attributes[b])}f.attributes=
d}this.options.callback&&(f.attributes&&0<Object.getOwnPropertyNames(f.attributes).length||f.addedNodes&&0<f.addedNodes.length||f.removedNodes&&0<f.removedNodes.length||f.characterData)&&this.options.callback(f)}});l.exports=e},{"./observer.js":17}],14:[function(e,l,h){var g=e("../../kern/Kern.js"),f=e("./observerfactory.js");e=g.EventManager.extend({constructor:function(){g.EventManager.call(this)},_domElementChanged:function(d){0<Object.getOwnPropertyNames(d.attributes).length&&this.trigger("attributesChanged",
d.attributes);(0<d.removedNodes.length||0<d.addedNodes.length)&&this.trigger("childrenChanged",{addedNodes:d.addedNodes,removedNodes:d.removedNodes})},observe:function(d,b){this.unobserve();var a=this;if(b.attributes||b.children)this._observer=f.getObserver(d,{attributes:b.attributes,attributeFilter:b.attributeFilter,childList:b.children||!1,timeout:b.timeout,callback:function(b){a._domElementChanged(b)}}),this._observer.observe();b.size&&(this._sizeObserver=f.getSizeObserver(d,{timeout:b.timeout,
callback:function(){a.trigger("sizeChanged")}}),this._sizeObserver.observe())},unobserve:function(){this._observer&&this._observer.stop();this._sizeObserver&&this._sizeObserver.stop()},isObserving:function(){return void 0!==this._observer&&this._observer.isObserving()||void 0!==this._sizeObserver&&this._sizeObserver.isObserving()}});l.exports=e},{"../../kern/Kern.js":32,"./observerfactory.js":18}],15:[function(e,l,h){arguments[4][13][0].apply(h,arguments)},{"./observer.js":17,dup:13}],16:[function(e,
l,h){var g=e("./ElementObserver.js");e=g.extend({constructor:function(f,d){g.call(this,f,d);var b=this;this.mutationObserver=new (f.ownerDocument.defaultView||f.ownerDocument.parentWindow).MutationObserver(function(a){b.mutationCallback(a)})},mutationCallback:function(f){for(var d={attributes:[],addedNodes:[],removedNodes:[]},b=0;b<f.length;b++){var a=f[b];this.options.attributes&&"attributes"===a.type&&(d.attributes[a.attributeName]={oldValue:this.attributes[a.attributeName],newValue:this.element.getAttribute(a.attributeName)},
this.attributes[a.attributeName]=d.attributes[a.attributeName].newValue);if(this.options.childList&&"childList"===a.type){if(a.addedNodes&&0<a.addedNodes.length)for(var e=0;e<a.addedNodes.length;e++)d.addedNodes.push(a.addedNodes[e]);if(a.removedNodes&&0<a.removedNodes.length)for(e=0;e<a.removedNodes.length;e++)d.removedNodes.push(a.removedNodes[e])}}this._invokeCallBack(d)},observe:function(){0!==this.counter&&this.counter--;0===this.counter&&(1===this.element.nodeType&&this.options.attributes&&
this._initalizeAttributes(),this.mutationObserver.observe(this.element,{attributes:this.options.attributes||!1,childList:this.options.childList||!1,characterData:this.options.characterData||!1}))},stop:function(){0===this.counter&&this.mutationObserver.disconnect();this.counter++}});l.exports=e},{"./ElementObserver.js":13}],17:[function(e,l,h){e=e("../../kern/kern.js").Base.extend({constructor:function(e,f){f=f||{};this.element=e;this.options=f;this.counter=1},observe:function(){throw"not implemented";
},stop:function(){throw"not implemented";},isObserving:function(){return 0===this.counter},_invokeCallBack:function(){this.options&&this.options.callback&&this.options.callback()}});l.exports=e},{"../../kern/kern.js":33}],18:[function(e,l,h){h=e("../../kern/kern.js");var g=e("./mutationsobserver.js"),f=e("./timeoutobserver.js"),d=e("./sizeobserver.js");e=h.Base.extend({constructor:function(){},getObserver:function(b,a){var d=b.ownerDocument.defaultView||b.ownerDocument.parentWindow;return d&&d.MutationObserver?
new g(b,a):new f(b,a)},getSizeObserver:function(b,a){return new d(b,a)}});l.exports=new e},{"../../kern/kern.js":33,"./mutationsobserver.js":16,"./sizeobserver.js":19,"./timeoutobserver.js":20}],19:[function(e,l,h){var g=e("./observer.js");e=g.extend({constructor:function(f,d){g.call(this,f,d);this.dimensions=void 0},observe:function(){0!==this.counter&&this.counter--;0===this.counter&&(this.dimensions={size_inner:{width:this.element.scrollWidth,height:this.element.scrollHeight},size:{width:this.element.clientWidth,
height:this.element.clientHeight}},this.checkSize())},stop:function(){this.counter++;1===this.counter&&(clearTimeout(this.myTimeout),this.myTimeout=void 0)},checkSize:function(){var f=this.element,d=f.scrollWidth,b=f.scrollHeight,a=f.clientWidth;f=f.clientHeight;if(a!==this.dimensions.size.width||f!==this.dimensions.size.height||d!==this.dimensions.size_inner.width||b!==this.dimensions.size_inner.height)this.dimensions.size={width:a,height:f},this.dimensions.size_inner={width:d,height:b},this._invokeCallBack();
var e=this;this.myTimeout=setTimeout(function(){e.checkSize()},this.options.timeout||100)}});l.exports=e},{"./observer.js":17}],20:[function(e,l,h){var g=e("./elementobserver.js");e=g.extend({constructor:function(f,d){g.call(this,f,d);this.childNodes=[];this.myTimeout=this.characterData=void 0},elementModified:function(){var f={attributes:{},addedNodes:[],removedNodes:[],characterData:!1};if(this.options.attributes&&1===this.element.nodeType){var d,b={};for(d in this.attributes)this.attributes.hasOwnProperty(d)&&
(b[d]=!1);for(var a=0;a<this.element.attributes.length;a++){var e=this.element.attributes[a];this.attributes.hasOwnProperty(e.name)?this.attributes[e.name]!==e.value&&(f.attributes[e.name]={oldValue:this.attributes[e.name],newValue:e.value},this.attributes[e.name]=e.value):(f.attributes[e.name]={oldValue:void 0,newValue:e.value},this.attributes[e.name]=e.value);b[e.name]=!0}for(d in b)b.hasOwnProperty(d)&&!b[d]&&(f.attributes[d]={oldValue:this.attributes[d],newValue:void 0},delete this.attributes[d])}if(this.options.childList&&
1===this.element.nodeType){for(d=0;d<this.childNodes.length;d++)b=this.childNodes[d],this.element.contains(b)||(this.childNodes.splice(d,1),f.removedNodes.push(b));for(d=0;d<this.element.childNodes.length;d++)b=this.element.childNodes[d],-1===this.childNodes.indexOf(b)&&(f.addedNodes.push(b),this.childNodes.push(b))}this.options.characterData&&3===this.element.nodeType&&this.characterData!==this.element.data&&(f.characterData=!0,this.characterData=this.element.data);this._invokeCallBack(f);this.observe()},
observe:function(){0!==this.counter&&this.counter--;if(0===this.counter){1===this.element.nodeType&&this.options.attributes&&this._initalizeAttributes();3===this.element.nodeType&&(this.characterData=this.element.data);this.childNodes=[];this.myTimeout=void 0;for(var f=this.element.childNodes.length,d=0;d<f;d++)this.childNodes.push(this.element.childNodes[d]);var b=this;this.myTimeout=setTimeout(function(){b.elementModified()},this.options.timeout||25)}},stop:function(){this.counter++;void 0!==this.myTimeout&&
(clearTimeout(this.myTimeout),this.myTimeout=void 0)}});l.exports=e},{"./elementobserver.js":15}],21:[function(e,l,h){var g=e("./pluginmanager.js"),f=e("./domhelpers.js"),d=e("../kern/Kern.js");layerJS.parseManager=new function(){this.parseDocument=function(b){b=b||document;this._parse(b,b)};this.parseElement=function(b,a){1===b.nodeType&&this._parse(b,b.ownerDocument,a)};this._parse=function(b,a,e){b=b.querySelectorAll("[data-lj-type='stage'],[lj-type='stage']");var k=b.length;e=e||{};for(var m=
layerJS.getState(a),c=0;c<k;c++){var n=g.createView(f.getAttributeLJ(b[c],"type"),d._extend(e,{el:b[c],document:a}));m.registerView(n)}}};l.exports=layerJS.parseManager},{"../kern/Kern.js":32,"./domhelpers.js":3,"./pluginmanager.js":22}],22:[function(e,l,h){h=e("./layerjs.js");var g=e("../kern/Kern.js");e=g.EventManager.extend({constructor:function(f,d){g.EventManager.call(this);this.map=f||{};this.identifyPriorities=d||{}},createView:function(f,d){if(d&&d.el&&d.el._ljView)return d.el._ljView;if("string"===
typeof f&&this.map.hasOwnProperty(f))return new this.map[f].view(d);throw"no constructor found for objects of type '"+f+"'";},registerType:function(f,d,b){this.map[f]={view:d,identify:d.identify};void 0===this.identifyPriorities[b]&&(this.identifyPriorities[b]=[]);this.identifyPriorities[b].push(d)},identify:function(f){for(var d,b=Object.keys(this.identifyPriorities).sort(function(a,b){return-1*(a-b)}),a=0;a<b.length;a++){for(var e=b[a],g=0;g<this.identifyPriorities[e].length;g++)if(this.identifyPriorities[e][g].identify(f)){d=
this.identifyPriorities[e][g].defaultProperties.type;break}if(void 0!==d)break}if(void 0===d)throw"no ViewType found for element '"+f+"'";return d}});h.pluginManager=new e({});l.exports=h.pluginManager},{"../kern/Kern.js":32,"./layerjs.js":7}],23:[function(e,l,h){String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e,f){var d=this.toString();if("number"!==typeof f||!isFinite(f)||Math.floor(f)!==f||f>d.length)f=d.length;f-=e.length;e=d.lastIndexOf(e,f);return-1!==
e&&e===f}});String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,f){return this.substr(f||0,e.length)===e}});Number.parseFloat||(Number.parseFloat=parseFloat)},{}],24:[function(e,l,h){var g=e("../../kern/Kern.js"),f=e("../parsemanager.js"),d=e("../domhelpers.js"),b=e("./staticrouter.js");e=b.extend({constructor:function(a){a=a||{};this._state=layerJS.getState();b.call(this,a);a.cacheCurrent&&(a=d.splitUrl(window.location.href),a.queryString=d.parseStringForTransitions(a.queryString,
!0).string,this.addRoute(d.joinUrl(a,!0),{pageTitle:document.title,state:this._state.exportState()}))},handle:function(a){var e=this,p=new g.Promise;b.prototype.handle.call(this,a).then(function(b){b.handled||b.optout?p.resolve(b):e._loadHTML(d.joinUrl(a,!0)).then(function(b){f.parseDocument(b);var c={},k=e._state;k.exportStructure().forEach(function(a){a=a.replace(/\$$/,"");c[a]={}});var m=layerJS.getState(b),h=[];m.exportStructure().forEach(function(a){a=a.replace(/\$$/,"");if(!(c[a]||0<h.filter(function(b){return a.startsWith(b)}).length)){var b=
!a.match(/\./),d=a.replace(/\.[^\.]*$/,"");if(c[d]||b){var f=m.resolvePath(a)[0].view.outerEl.outerHTML;b=b?document.body:k.resolvePath(d)[0].view.innerEl;b.insertAdjacentHTML("beforeend",f);b.lastChild.style.display="none";f=b.lastChild.getElementsByTagName("script");for(b=0;b<f.length;b++){d=f[b];var e=document.createElement("script");e.text=d.innerHTML;for(var g=d.attributes.length-1;0<=g;g--)e.setAttribute(d.attributes[g].name,d.attributes[g].value);d.parentNode.replaceChild(e,d)}h.push(a)}else throw"filerouter: didn't find '"+
d+"' in current document to add new '"+a+"'";}});0===h.length&&console.warn("layerJS: filerouter: loaded new document '"+d.joinUrl(a,!0)+"' but didn't add any new content. You should give the frame that should be added a different name or id.");var l=m.exportState(),r=l.filter(function(a){var b=a.split(".").pop().startsWith("!"),d=a;b&&(d=a.replace(/\.[^\.]*$/,""));return c.hasOwnProperty(d)||-1!==h.indexOf(d)}),y=r.map(function(){return g._extend({},a.globalTransition)});e.addRoute(d.joinUrl(a,!0),
{state:l,pageTitle:b.title});d.postAnimationFrame(function(){p.resolve({stop:!1,handled:!0,paths:r,transitions:y})})},function(){p.resolve({stop:!1,handled:!1,paths:[],transitions:[]})})});return p},_loadHTML:function(a){var b=new g.Promise;try{var d=new XMLHttpRequest;d.onerror=function(){b.reject()};d.onload=function(){if(200===d.status){var a=document.implementation.createHTMLDocument("framedoc");a.documentElement.innerHTML=d.responseText;b.resolve(a)}else b.reject()};d.open("GET",a);d.responseType=
"text";d.send()}catch(m){b.reject(m)}return b}});l.exports=e},{"../../kern/Kern.js":32,"../domhelpers.js":3,"../parsemanager.js":21,"./staticrouter.js":27}],25:[function(e,l,h){var g=e("../../kern/Kern.js"),f=e("../domhelpers.js");e=g.EventManager.extend({handle:function(d){var b=new g.Promise;if(void 0===d.hash||"#"===d.hash||""===d.hash)b.resolve({handled:!1,stop:!1,paths:[]});else{for(var a=(d.hash.startsWith("#")?d.hash.substr(1):d.hash).split(";"),e=[],p=[],m=layerJS.getState(),c=function(a){return function(b){return a===
b.replace(/\.[^\.]*$/,"")}},n=0;n<a.length;n++){var q=a[n].split("?")[0].split("&")[0].replace("(","").replace(")",""),h=f.parseStringForTransitions(a[n]),l=!1;try{for(var z=m.resolvePath(q),r=0;r<z.length;r++){var y=z[r];y.hasOwnProperty("frameName")&&y.hasOwnProperty("layer")&&(e.push(y.path),p.push(g._extend(d.globalTransition,h.transition)),l=!0)}}catch(D){}if(!l&&(l=(l=document.getElementsByName(q))&&l[0]||document.getElementById(q))&&"none"!==window.getComputedStyle(l).display&&(r=f.findParentViewOfType(l,
"frame"),void 0!==r)){var t=m.buildPath(r.outerEl,!1),u=e.indexOf(t);if(-1!==u)var w=p[u];else if(-1===u&&(t=t.replace(/\.[^\.]*$/,""),t=d.paths.filter(c(t)),1===t.length)){var x=m.resolvePath(t[0])[0].view;if((q=(q=x.outerEl.querySelectorAll("[name="+q+"], #"+q))&&q[0])&&"none"!==window.getComputedStyle(q).display){var C="none"===window.getComputedStyle(x.outerEl).display;C&&(x.outerEl.style.opacity=0,x.outerEl.style.display="");l=q;u=d.paths.indexOf(t[0]);w=d.transitions[u];l={offsetTop:q.offsetTop,
offsetLeft:q.offsetLeft};C&&(x.outerEl.style.display="none",x.outerEl.style.opacity=1)}}-1===u&&r.parent.currentFrame===r&&(e.push(m.buildPath(r.outerEl,!1)),w=g._extend({},d.globalTransition,h.transition),p.push(w));w&&(w.scrollY=l.offsetTop,w.scrollX=l.offsetLeft)}}b.resolve({stop:!1,handled:0<e.length,paths:e,transitions:p})}return b},buildUrl:function(d){for(var b=layerJS.getState(),a=[],f=0;f<d.state.length;f++){var e=d.state[f].split("."),m=void 0,c=!1;do{m=e.pop()+(m?"."+m:"");var g=b.resolvePath(m);
1===g.length&&(c=!0,m=g[0].view&&g[0].view.originalParent&&g[0].view.originalParent!==g[0].view.parent?d.state[f]:m)}while(!c&&0<e.length);c&&(a.push(m),d.state.splice(f,1),f--)}d.hash=a.join(";")}});l.exports=e},{"../../kern/Kern.js":32,"../domhelpers.js":3}],26:[function(e,l,h){var g=e("../layerjs.js"),f=e("../domhelpers.js"),d=e("../../kern/kern.js"),b=e("./staticrouter.js");e=d.EventManager.extend({constructor:function(a){this._init(a)},_init:function(a){this.rootElement=a||document;this.routers=
[];this._registerLinkClickedListener();this.addToHistory=!0;this.isClickEvent=!1;this.state=g.getState();this.state.on("stateChanged",this._stateChanged,{context:this})},addRouter:function(a){this.routers.push(a);a instanceof b&&(this.staticRouter=a)},clearRouters:function(){this.routers=[]},_registerLinkClickedListener:function(){var a=this;window.onpopstate=function(b){document.location.href===a.ignoreUrl?delete a.ignoreUrl:b&&b.state&&b.state.state?a.state.transitionTo(b.state.state,b.state.transitions,
{noHistory:!0}):a.navigate(document.location.href,null,!0)};f.addDelegtedListener(this.rootElement,"click","a:not([data-lj-nolink='true']):not([lj-nolink='true'])",function(b){var d=function(b){b||setTimeout(function(){a.ignoreUrl=f.getAbsoluteUrl(e);window.location.href=e},1)};if(""!==this.href&&!this.href.startsWith("javascript:")){var e=this.getAttribute("href"),c=this.getAttribute("target");c&&"_self"!==c||(b.preventDefault(),a.navigate(e,f.findParentViewOfType(this,"layer")).then(d))}})},navigate:function(a,
b,e,m){var c=d._extend(f.splitUrl(a),{transitions:[],context:b,paths:[],globalTransition:{}});if(c.location||c.queryString)c.explLoc=!0,d._extend(c,f.splitUrl(f.getAbsoluteUrl(a)));if(b=c.queryString&&f.parseStringForTransitions(c.queryString,!1))c.globalTransition=b.transition,c.queryString=b.string;var g=this.routers.length,k=this,p=new d.Promise,h=!1,l=function(){h&&(!0===m?k.state.showState(c.paths,c.transitions,{paths:c.paths,transitions:c.transitions,noHistory:e,originalUrl:a,initial:m}):k.state.transitionTo(c.paths,
c.transitions,{paths:c.paths,transitions:c.transitions,noHistory:e,originalUrl:a}));p.resolve(h)},r=function(a){a<g?k.routers[a].handle(c).then(function(b){b.handled&&(h=b.handled,Array.prototype.push.apply(c.paths,b.paths),Array.prototype.push.apply(c.transitions,b.transitions));b.handled&&!b.stop||!b.handled?r(a+1):l()}):l()};c.location&&c.location.match(/^\w+:/)&&!c.location.match(new RegExp("^"+window.location.origin))?p.resolve(!1):r(0);return p},_stateChanged:function(a,b){b=b||{};b.state=b.state||
[];b.transitions=b.transitions||[];var e=a&&a.exportMinimizedState()||{state:[],defaultState:[],omittedState:[]};a=e.state.concat(e.omittedState).concat(e.defaultState).filter(function(a){return 0>b.state.indexOf(a)&&b.state.indexOf(a.replace("$"))});a=b.state.concat(a);var m=b.transitions;e=d._extend(f.splitUrl(window.location.href),e);e.queryString=f.parseStringForTransitions(e.queryString,!1).string;for(var c=0;c<this.routers.length;c++)this.routers[c].buildUrl(e);c=f.joinUrl(e);!window.history||
b&&b.noHistory||window.location.href===c?!window.history||b&&b.noHistory&&!b.initial||(window.history.replaceState({state:a,transitions:m},"",c),document.title=e.pageTitle):(window.history.pushState({state:a,transitions:m},"",c),document.title=e.pageTitle)}});l.exports=g.router=new e},{"../../kern/kern.js":33,"../domhelpers.js":3,"../layerjs.js":7,"./staticrouter.js":27}],27:[function(e,l,h){var g=e("../../kern/kern.js"),f=e("../domhelpers.js");e=g.EventManager.extend({constructor:function(){this.routes=
{}},addRoute:function(d,b,a){d=f.getAbsoluteUrl(d);a&&this.routes.hasOwnProperty(d)||(this.routes[d]=b)},hasRoute:function(d){d=f.getAbsoluteUrl(d);return this.routes.hasOwnProperty(d)},handle:function(d){var b=f.joinUrl(d,!0),a=!b||!d.explLoc&&f.joinUrl(f.splitUrl(window.location.href),!0)===b;var e=a?!1:this.hasRoute(b);var p=new g.Promise,m=[],c=[];e&&(m=this.routes[b].state,m.forEach(function(){c.push(g._extend({},d.globalTransition))}));p.resolve({stop:!1,handled:e,transitions:c,optout:a,paths:m});
return p},buildUrl:function(d){var b=d.state.concat(d.defaultState),a=this,e=f.joinUrl(d,!0);var g=e;var m=function(b){return a.routes[e]&&-1!==a.routes[e].state.indexOf(b)},c=b.filter(m),n=c.length;for(e in this.routes)if(this.routes.hasOwnProperty(e)&&this.routes[e].state.length>n){var h=b.filter(m),l=h.length;l>n&&(c=h,n=l,g=e)}this.routes.hasOwnProperty(g)&&this.routes[g].pageTitle&&(d.pageTitle=this.routes[g].pageTitle);g=f.splitUrl(g);d.location=g.location;d.queryString=g.queryString;c.forEach(function(a){var b=
d.state.indexOf(a);-1!==b?d.state.splice(b,1):d.defaultState.splice(d.defaultState.indexOf(a),1)})}});l.exports=e},{"../../kern/kern.js":33,"../domhelpers.js":3}],28:[function(e,l,h){var g=e("../kern/Kern.js"),f=e("./domhelpers.js");e=g.EventManager.extend({constructor:function(d){g.EventManager.call(this);var b=this;if(!d)throw"provide a layer";this.layer=d;this.layer.outerEl.addEventListener("scroll",function(){if(b.layer.nativeScroll()){var a=b.layer.currentFrameTransformData;a.scrollX=b.layer.outerEl.scrollLeft/
a.scale;a.scrollY=b.layer.outerEl.scrollTop/a.scale;b.layer.trigger("scroll")}})},scrollTransform:function(d,b){return"translate3d("+d+"px,"+b+"px,0px)"},_detectInnerScrolling:function(d){for(var b=d.event.target;b&&b!==this.layer.innerEl;){if(Math.abs(d.shift.x)>Math.abs(d.shift.y)){if(b.clientWidth<b.scrollWidth&&!(window.getComputedStyle(b)["overflow-x"]in{visible:1,hidden:1})&&(0<d.shift.x&&0<b.scrollLeft||b.scrollLeft<b.scrollWidth-b.clientWidth))return d.event.stopPropagation(),!0}else if(b.clientHeight<
b.scrollHeight&&!(window.getComputedStyle(b)["overflow-y"]in{visible:1,hidden:1})&&(0<d.shift.y&&0<b.scrollTop||b.scrollTop<b.scrollHeight-b.clientHeight))return d.event.stopPropagation(),!0;b=b.parentElement}return!1},scrollGestureListener:function(d){var b=this.layer.currentFrameTransformData;if(d.first)return this.scrollStartX=b.scrollX,this.scrollStartY=b.scrollY,!0;if(this._detectInnerScrolling(d))return!0;var a=Math.abs(d.shift.x)>Math.abs(d.shift.y)?"x":"y";if("x"===a&&!b.isScrollX||"y"===
a&&!b.isScrollY)return!1;if(this.layer.nativeScroll()){if(10>Math.abs(d.shift.x)+Math.abs(d.shift.y))return!0;if("y"===a)return 0<d.shift.y?0<b.scrollY:this.layer.outerEl.scrollHeight-this.layer.outerEl.clientHeight-1>this.layer.outerEl.scrollTop;if("x"===a)return 0<d.shift.x?0<b.scrollX:this.layer.outerEl.scrollWidth-this.layer.outerEl.clientWidth-1>this.layer.outerEl.scrollLeft}else{if("y"===a)if(0<d.shift.y){if(0===b.scrollY)return!1}else{if(1>b.maxScrollY-b.scrollY)return!1}else if("x"===a)if(0<
d.shift.x){if(0===b.scrollX)return!1}else if(1>b.maxScrollX-b.scrollX)return!1;b.scrollX=this.scrollStartX-d.shift.x/b.scale;b.scrollY=this.scrollStartY-d.shift.y/b.scale;b.isScrollX||(b.scrollX=this.scrollStartX);b.isScrollY||(b.scrollY=this.scrollStartY);0>b.scrollX&&(b.scrollX=0);b.scrollX>b.maxScrollX&&(b.scrollX=b.maxScrollX);0>b.scrollY&&(b.scrollY=0);b.scrollY>b.maxScrollY&&(b.scrollY=b.maxScrollY);return this.scrollTransform(-b.scrollX*b.scale,-b.scrollY*b.scale)}},switchNativeScroll:function(d){},
getScrollTransform:function(d,b,a){var e=b.scrollX||d.scrollX,g=b.scrollY||d.scrollY;a||(e=b.scrollX||d.initialScrollX,g=b.scrollY||d.initialScrollY);d.scrollX=void 0!==e?e:d.scrollX;d.scrollY=void 0!==g?g:d.scrollY;d.scrollX>d.maxScrollX&&(d.scrollX=d.maxScrollX);d.scrollY>d.maxScrollY&&(d.scrollY=d.maxScrollY);0>d.scrollX&&(d.scrollX=0);0>d.scrollY&&(d.scrollY=0);if(this.layer.nativeScroll()){if(a)return a=b=0,b=(this.layer.outerEl.scrollLeft||0)-(d.scrollX*d.scale||0),a=(this.layer.outerEl.scrollTop||
0)-(d.scrollY*d.scale||0),this.scrollTransform(b,a);this.layer.innerEl.style.height=d.isScrollY?d.height+"px":"100%";this.layer.innerEl.style.width=d.isScrollX?d.width+"px":"100%";this.layer.outerEl.scrollLeft=d.scrollX*d.scale;this.layer.outerEl.scrollTop=d.scrollY*d.scale;if("ios"===f.browser){this.layer.outerEl.style["-webkit-overflow-scrolling"]="auto";var m=this;setTimeout(function(){m.layer.outerEl.style["-webkit-overflow-scrolling"]="touch"},1)}return this.scrollTransform(0,0)}return this.scrollTransform(-d.scrollX*
d.scale,-d.scrollY*d.scale)}});l.exports=e},{"../kern/Kern.js":32,"./domhelpers.js":3}],29:[function(e,l,h){h=e("./pluginmanager.js");var g=e("./defaults.js"),f=e("./domhelpers.js"),d=e("./baseview.js"),b=d.extend({constructor:function(a){a=a||{};a.childType="layer";d.call(this,a)},registerEventHandlers:function(){var a=this,b=function(){a.trigger("renderRequired")};d.prototype.registerEventHandlers.call(this);window.addEventListener("resize",b,!1);this.on("sizeChanged",b)},startObserving:function(){d.prototype.observe.call(this,
this.innerEl,{attributes:!0,children:!0,size:!0})},_renderChildPosition:function(a){1===a.nodeType()&&(a.unobserve(),a.outerEl.style.left="0px",a.outerEl.style.top="0px",a.startObserving())},_parseChildren:function(a){var b=this,e=this.autoWidth()||this.autoHeight(),f=function(a){return function(c,d){d=d||{};c=a.currentFrameTransformData;d={transition:d.duration||""};b.autoWidth()?d.width=c.width:b.autoHeight()&&(d.height=c.height);b.applyStyles(d)}};d.prototype._parseChildren.call(this,a);if(e){a=
null;for(var c=0;c<this._cache.children.length;c++)this._cache.children[c].name()===e&&(this._cache.children[c].on("transitionStarted",f(this._cache.children[c])),a=this._cache.children[c]);!a&&this._cache.children[0]&&(this._cache.children[0].on("transitionStarted",f(this._cache.children[0])),a=this._cache.children[0]);a&&f(a)()}}},{defaultProperties:{type:"stage"},identify:function(a){a=f.getAttributeLJ(a,"type");return null!==a&&a.toLowerCase()===b.defaultProperties.type}});h.registerType("stage",
b,g.identifyPriority.normal);l.exports=b},{"./baseview.js":1,"./defaults.js":2,"./domhelpers.js":3,"./pluginmanager.js":22}],30:[function(e,l,h){var g=e("../kern/Kern.js");h=e("./layerjs.js");var f=e("./domhelpers.js"),d=g.EventManager.extend({constructor:function(b){this.document=b||document;this.document._ljState=this;this.viewTypes=["stage","layer","frame"];this.views={};this.layers=[];this.paths={};this._transitionGroup={};g.EventManager.call(this);this.previousState=void 0},registerView:function(b){if(b.document.body.contains(b.outerEl)){var a=
b.id();if(this.views[a]){if(this.views[a].view!==b)throw"state.registerView: duplicate HTML id '"+a+"'";}else{var d=this.buildPath(b.outerEl);this.views[a]={view:b,path:d};var f=this;this.getTrailingPaths(d).forEach(function(b){(f.paths[b]=f.paths[b]||[]).push(a)});"layer"===b.type()&&this.layers.push(a);b.on("childRemoved",function(a){(a.parent&&b.id()===a.parent.id()||void 0===a.parent)&&f.unregisterView(a)},{context:this});b.on("childAdded",function(a){f.views[a.id()]&&f.unregisterView(a);f.registerView(a)},
{context:this});b.on("transitionStarted",function(a,b){var c=!0,d={};if(!b||b.lastFrameName!==a||b.hasOwnProperty("groupId")&&this._transitionGroup.hasOwnProperty(b.groupId))b&&b.hasOwnProperty("groupId")&&this._transitionGroup.hasOwnProperty(b.groupId)&&(this._transitionGroup[b.groupId].length--,b.lastFrameName!==a&&(this._transitionGroup[b.groupId].changed=!0),c=0===this._transitionGroup[b.groupId].length&&this._transitionGroup[b.groupId].changed,d=this._transitionGroup[b.groupId].payload),c&&(!b||
b&&!b.isEvent)&&this.trigger("stateChanged",this,d)},{context:this});b.on("attributesChanged",this._attributesChangedEvent(b),{context:this});b.getChildViews().forEach(function(a){f.registerView(a)})}}},unregisterView:function(b){var a=b.id(),d=this;this.getTrailingPaths(this.views[a].path).forEach(function(b){var c=d.paths[b].indexOf(a);d.paths[b].splice(c,1);0===d.paths[b].length&&delete d.paths[b]});if("layer"===b.type()){var f=this.layers.indexOf(b);this.layers.splice(f,1)}delete this.views[a];
b.off(void 0,void 0,this);b.getChildViews().forEach(function(a){d.unregisterView(a)})},exportState:function(){return this._exportState().state},exportMinimizedState:function(){return this._exportState(!0)},_exportState:function(b){b=b||!1;var a={state:[],defaultState:[],omittedState:[]},d=this;d.exportStructure("frame").forEach(function(f){var e=f.endsWith("$"),c=f;e&&(c=c.substr(0,c.length-1));c=d.paths[c];if(1<c.length)throw"state.exportState: multiple frames found for "+f;c=d.views[c[0]].view;
var g=c.parent;c===g.currentFrame?!0===b&&g.noUrl()?a.omittedState.push(f):!0===b&&(g.currentFrame.name()===g.defaultFrame()||null===g.defaultFrame()&&null===g.currentFrame.outerEl.previousElementSibling)?a.defaultState.push(f):a.state.push(f):e&&c.parent!==c.originalParent?a.state.push(f):e&&a.omittedState.push(f)});this.layers.map(function(a){return d.views[a].view}).filter(function(a){return null===a.currentFrame||void 0===a.currentFrame}).forEach(function(f){!0===b&&f.noUrl()?a.omittedState.push(d.views[f.id()].path+
".!none"):!0===b&&"!none"===f.defaultFrame()?a.defaultState.push(d.views[f.id()].path+".!none"):a.state.push(d.views[f.id()].path+".!none")});return a},exportStructure:function(b){var a=this,d=Object.keys(this.views).map(function(b){return a.views[b].view.outerEl}).sort(f.comparePosition);b&&(d=d.filter(function(a){return a._ljView.type()===b}));return d.map(function(b){var d=!0;"frame"===b._ljView.type()&&(d=b._ljView,d=d.parent.currentFrame===d);return a.views[b._ljView.id()].path+(d?"":"$")})},
transitionTo:function(b,a,d){this._transitionTo(!1,b,a,d)},showState:function(b,a,d){return this._transitionTo(!0,b,a,d)},_transitionTo:function(b,a,d,e){var m=this;d=d||[];e=e||{};e.state=a;e.transitions=d.map(function(a){return g._extend({},a)});var c={},n={},k={},h=function(a){var b=c[a].layer.id();k=c[a].transition;delete c[a];delete n[b]};a.map(function(a){return m.resolvePath(a)}).forEach(function(a,b){for(var f=0;f<a.length;f++){var e=a[f],m=e.layer.id();k={};var l=g._extend(k,d[Math.min(b,
d.length-1)]||{});!0!==e.noActivation&&(e.isInterStage&&c.hasOwnProperty(e.originalPath)&&h(e.originalPath),c.hasOwnProperty(e.path)&&h(e.path),n.hasOwnProperty(m)&&h(n[m]),n[m]=e.path);if(!0!==e.noActivation||e.isInterStage)c[e.path]={layer:e.layer,frameName:e.frameName,transition:g._extend({noActivation:e.noActivation},k,l)}}});a=Object.getOwnPropertyNames(c);var l=new g.Semaphore(a.length),p=f.uniqueID("group");this._transitionGroup[p]={length:a.length,payload:e};for(e=0;e<a.length;e++){var r=
c[a[e]];r.transition.semaphore=l;r.transition.groupId=p;b?r.layer.showFrame(r.frameName,r.transition):r.layer.transitionTo(r.frameName,r.transition)}return 0<d.length},buildPath:function(b,a){if(!b)return"";if(!b._ljView)return this.buildPath(b.parentNode);var d=b._ljView.parent;a=!a&&d?this.views[d.id()].path:this.buildPath(b.parentNode);""!==a&&(a+=".");return a+b._ljView.name()},getTrailingPaths:function(b){for(var a=[b];b=b.replace(/^[^\.]*\.?/,"");)a.push(b);return a},resolvePath:function(b,
a){var d=b.endsWith("$");d&&(b=b.substr(0,b.length-1));var f=a&&this.buildPath(a),e=b.split(".");a=e.pop();var c="!"===a[0];var g=e.join(".");e=c?g?this.paths[g]:this.layers:this.paths[b];c||e&&0!==e.length||!g||(e=this.paths[g]);if(!e||0===e.length)return[];if(1<e.length&&f){for(var h=[];0===h.length&&f;){for(g=0;g<e.length;g++)this.views[e[g]].path.startsWith(f)&&h.push(e[g]);f=f.replace(/\.?[^\.]$/,"")}e=h.length?h:e}f=[];for(g=0;g<e.length;g++){h=this.views[e[g]].view;var l=this.views[e[g]].path;
if(c){if("layer"!==h.type())throw"state: expected layer name in front of '"+a+"'";f.push({layer:h,frameName:a,path:l+"."+a+(d?"$":"")})}else if("frame"===h.type())f.push({layer:h.parent,view:h,frameName:a,path:l+(d?"$":""),active:void 0!==h.parent.currentFrame&&null!==h.parent.currentFrame?h.parent.currentFrame.name()===a:!1,noActivation:d});else if("layer"===h.type())if(l.endsWith(b))f.push({view:h,path:l});else{var v=this.resolvePath(a);1===v.length&&f.push({layer:h,frameName:a,view:v[0].view,path:l+
"."+a+(d?"$":""),active:!1,isInterStage:!0,originalPath:v[0].path,noActivation:d})}else f.push({view:h,path:l})}return f},_attributesChangedEvent:function(b){var a=this;return function(d){if(d["lj-name"]||d["data-lj-name"]||d.id)a.unregisterView(b),a.registerView(b)}}});h.getState=function(b){b=b||document;return b._ljState||new d(b)};l.exports=d},{"../kern/Kern.js":32,"./domhelpers.js":3,"./layerjs.js":7}],31:[function(e,l,h){var g=function(e){e instanceof Array?(this.a=e[0],this.b=e[1],this.c=e[2],
this.d=e[3],this.tx=e[4],this.ty=e[5]):(this.a=this.d=1,this.b=this.c=this.tx=this.ty=0)};g.prototype={prod:function(e){return new g([this.a*e.a+this.b*e.c,this.a*e.b+this.b*e.d,this.c*e.a+this.d*e.c,this.c*e.b+this.d*e.d,this.a*e.tx+this.b*e.ty+this.tx,this.c*e.tx+this.d*e.ty+this.ty])},transform:function(){return"matrix("+this.a.toFixed(4)+","+this.c.toFixed(4)+","+this.b.toFixed(4)+","+this.d.toFixed(4)+","+this.tx.toFixed(4)+","+this.ty.toFixed(4)+")"},transform_nomatrix:function(e){var d=this.get_translation_equal(),
b=this.get_scale_equal(),a=this.get_rotation_equal();d=g.Tscale(0<b?1/b:b).prod(g.Trot(-a)).transform_vec(d);1E-6>Math.abs(d.x)&&(d.x=0);1E-6>Math.abs(d.y)&&(d.y=0);return"scale("+this.get_scale_equal()+") rotate("+(this.get_rotation_equal()+(e?e:0))+"deg) "+g.getTranslateString(d.x,d.y)},transform_vec:function(e){return{x:this.a*e.x+this.b*e.y+this.tx,y:this.c*e.x+this.d*e.y+this.ty}},invert:function(){var e=1/(this.a*this.d-this.b*this.c||1),d=e*this.d,b=-e*this.b,a=-e*this.c;e*=this.a;return new g([d,
b,a,e,-d*this.tx-b*this.ty,-a*this.tx-e*this.ty])},get_scale_equal:function(){var e=this.a,d=this.c;return Math.sqrt(e*e+d*d)},get_rotation_equal:function(){return 180/Math.PI*Math.atan2(this.b,this.a)},get_translation_equal:function(){return{x:this.tx,y:this.ty}},set_scale_equal:function(e){var d=this.get_scale_equal();this.a*=e/d;this.b*=e/d;this.c*=e/d;this.d*=e/d},copy:function(){return new g([this.a,this.b,this.c,this.d,this.tx,this.ty])},clearShift:function(){this.ty=this.tx=0;return this}};
g.Trot=function(e){e=e*Math.PI/180;return new g([Math.cos(e),-Math.sin(e),Math.sin(e),Math.cos(e),0,0])};g.Tscale=function(e){return new g([e,0,0,e,0,0])};g.Tscalexy=function(e,d){return new g([e,0,0,d,0,0])};g.Ttrans=function(e,d){return new g([1,0,0,1,e,d])};g.Tall=function(e,d,b,a){a=a*Math.PI/180;return new g([b*Math.cos(a),-b*Math.sin(a),b*Math.sin(a),b*Math.cos(a),e,d])};g.getTranslateString=function(e,d){return"translate3d("+e+"px,"+d+"px,0)"};l.exports=g},{}],32:[function(e,l,h){(function(){var e=
function(){function e(a,b){return(new Function("c","return function "+a+"(){c.apply(this, arguments)}"))(b)}var d=function(a){var b=arguments.length;if(2>b)throw"too few arguments in _extend";if(null===a)throw"no object provided in _extend";for(var d=1;d<b;d++)for(var e=Object.keys(arguments[d]),f=0;f<e.length;f++)a[e[f]]=arguments[d][e[f]];return a},b=function(a){if("object"===typeof a){if(Array.isArray(a)){var c=[];for(var d=a.length-1;0<=d;d--)c[d]=b(a[d]);return c}if(null===a)return null;c={};
for(d in Object.keys(a))a.hasOwnProperty(d)&&(c[d]=b(a[d]));return c}return a},a={_extend:d,_extendKeep:function(a){var b=arguments.length;if(2>b)throw"too few arguments in _extend";if(null===a)throw"no object provided in _extend";for(var d=1;d<b;d++)for(var e=Object.keys(arguments[d]),f=0;f<e.length;f++)a.hasOwnProperty(e[f])||(a[e[f]]=arguments[d][e[f]]);return a},_extendKeepDeepCopy:function(a){var c=arguments.length;if(2>c)throw"too few arguments in _extend";if(null===a)throw"no object provided in _extend";
for(var d=1;d<c;d++)for(var e=Object.keys(arguments[d]),f=0;f<e.length;f++)a.hasOwnProperty(e[f])||(a[e[f]]=b(arguments[d][e[f]]));return a}},g=a.Base=function(){};g.extend=function(a,b){a=a||{};b=b||{};var c=this,f=a.hasOwnProperty("constructor")?a.constructor:function(){return c.apply(this,arguments)};b&&b.className&&(f=e(b.className,f));delete a.constructor;f.prototype=Object.create(c.prototype);f.prototype.constructor=f;d(f.prototype,a);d(f,this,b);return f};a.EventManager=g.extend({constructor:function(){this.__listeners__=
{}},on:function(a,b,d){this.__listeners__[a]=this.__listeners__[a]||[];this.__listeners__[a].push({callback:b,options:d||{}});return this},once:function(a,b,d){var c=this,e=function(){b.apply(this,arguments);c.off(a,e)};this.on(a,e,d);return this},off:function(a,b,d){if(a)if(b||d){var c=this.__listeners__[a];for(a=0;a<c.length;a++)b&&c[a].callback!==b||d&&c[a].options.context!==d||c.splice(a,1)}else delete this.__listeners__[a];else if(b||d)for(var e in this.__listeners__){if(this.__listeners__.hasOwnProperty(e))for(c=
this.__listeners__[e],a=0;a<c.length;a++)b&&c[a].callback!==b||d&&c[a].options.context!==d||c.splice(a,1)}else this.__listeners__={};return this},trigger:function(a){if(this.__listeners__[a])for(var b=0;b<this.__listeners__[a].length;b++){for(var d=arguments.length,e=Array(d-1),f=0;f<d-1;f++)e[f]=arguments[f+1];d=this.__listeners__[a][b];d.callback.apply(d.options.context||this,e)}return this},triggerBy:function(a,b){if(this.__listeners__[b])for(var c=0;c<this.__listeners__[b].length;c++)if(!this.__listeners__[b][c].options.ignoreSender||
this.__listeners__[b][c].options.ignoreSender!==a){for(var d=arguments.length,e=Array(d-2),f=0;f<d-2;f++)e[f]=arguments[f+2];d=this.__listeners__[b][c];d.callback.apply(d.options.context||this,e)}return this}});var h=a.Promise=g.extend({constructor:function(){this.reason=this.value=this.state=void 0},then:function(a,b){this.nextPromise=new h;this.fn=a;this.errFn=b;void 0!==this.state&&this.execute();return this.nextPromise},resolve:function(a){if(void 0!==this.state)console.warn("Promise: double resolve/reject (ignored).");
else return this.state=!0,this.value=a,this.execute(),this},reject:function(a){if(void 0!==this.state)console.warn("Promise: double resolve/reject (ignored).");else return this.state=!1,this.reason=a,this.execute(),this},execute:function(){if(this.nextPromise){var a=this;if(!0===this.state){if(this.fn)try{var b=this.fn(this.value);b instanceof h?b.then(function(b){a.nextPromise.resolve(b)},function(b){a.nextPromise.reject(b)}):a.nextPromise.resolve(b)}catch(n){console.log("in Promise handler:",n),
this.nextPromise.reject(n)}}else!1===this.state&&(this.errFn&&this.errFn(this.reason),this.nextPromise.reject(this.reason))}}});a.Semaphore=g.extend({constructor:function(a){this.num=a||0;this.cc=0;this.ps=[];this.ls=[];this.ls2=[]},register:function(){this.num++;return this},listen:function(b){var c=new a.Promise;b?this.ls.push(c):this.ls2.push(c);return c},skip:function(){this.num--;if(0>this.num)throw"semaphore: skipped stakeholder that was not registered";this.num===this.cc&&(this.cc--,this.sync())},
sync:function(){var b;this.cc++;this.ps.push(b=new a.Promise);if(this.cc===this.num){for(var c=0;c<this.ls.length;c++)this.ls[c].resolve(this.num);for(c=0;c<this.ps.length;c++)this.ps[c].resolve(this.num);var d=this;setTimeout(function(){for(var a=0;a<d.ls2.length;a++)d.ls2[a].resolve(d.num)},0)}else if(this.cc>=this.num)throw"semaphore: more syncs than stakeholders";return b}});a.Queue=g.extend({constructor:function(){this.q=[];this.waiting=!1},add:function(b){var c=new a.Promise;if(this.waiting){var d=
0<this.q.length&&b===this.q[this.q.length-1].category;void 0!==b&&d&&this.q.pop().promise.reject();this.q.push({promise:c,category:b})}else c.resolve(),this.waiting=!0;return c},continue:function(){this.q.length?this.q.shift().promise.resolve():this.waiting=!1},clear:function(){for(;0<this.q.length;)this.q.shift().promise.reject();this.waiting=!1}});return a};"function"===typeof define&&define.amd?define("Kern",[],e):"undefined"!==typeof l&&l.exports?(e=e(),l.exports=e):window.Kern=e()})()},{}],33:[function(e,
l,h){arguments[4][32][0].apply(h,arguments)},{dup:32}],34:[function(e,l,h){e("./kern/kern.js");e("./framework/layerjs.js");e("./framework/state.js");e("./framework/pluginmanager.js");e("./framework/layoutmanager.js");e("./framework/parsemanager.js");e("./framework/layouts/layerlayout.js");e("./framework/layouts/slidelayout.js");e("./framework/layouts/canvaslayout.js");e("./framework/gestures/gesturemanager.js");e("./framework/router/router.js");e("./framework/defaults.js");e("./framework/layerview.js");
e("./framework/frameview.js");e("./framework/stageview.js");var g=window.location.href,f=e("./framework/router/filerouter.js"),d=e("./framework/router/hashrouter.js"),b=e("./framework/domhelpers.js"),a=!1;layerJS.init=function(){if(!a){a=!0;layerJS.parseManager.parseDocument();var e=b.getAttributeLJ(document.body,"router");e&&"filerouter"===e.toLowerCase()&&layerJS.router.addRouter(new f({cacheCurrent:!0}));layerJS.router.addRouter(new d);layerJS.router.navigate(g,null,!0,!0).then(function(){})}};
"interactive"===document.readyState?b.getAttributeLJ(document.body,"no-init")||a||layerJS.init():document.addEventListener("DOMContentLoaded",function(){b.getAttributeLJ(document.body,"no-init")||a||layerJS.init()});console.log("*** layerJS *** checkout http://layerjs.org *** happy to help you: developers@layerjs.org ***")},{"./framework/defaults.js":2,"./framework/domhelpers.js":3,"./framework/frameview.js":4,"./framework/gestures/gesturemanager.js":6,"./framework/layerjs.js":7,"./framework/layerview.js":8,
"./framework/layoutmanager.js":9,"./framework/layouts/canvaslayout.js":10,"./framework/layouts/layerlayout.js":11,"./framework/layouts/slidelayout.js":12,"./framework/parsemanager.js":21,"./framework/pluginmanager.js":22,"./framework/router/filerouter.js":24,"./framework/router/hashrouter.js":25,"./framework/router/router.js":26,"./framework/stageview.js":29,"./framework/state.js":30,"./kern/kern.js":33}]},{},[34]);